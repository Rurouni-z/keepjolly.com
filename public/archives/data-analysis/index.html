<!DOCTYPE html>
<html lang="zh-CN">
    <head prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#"><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="UTF-8" />

    <meta name="generator" content="Hugo 0.140.2"><meta name="theme-color" content="#fff" />
    <meta name="color-scheme" content="light dark">

    
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <meta name="format-detection" content="telephone=no, date=no, address=no, email=no" />
    
    <meta http-equiv="Cache-Control" content="no-transform" />
    
    <meta http-equiv="Cache-Control" content="no-siteapp" />

    <title>æ•°å­¦å»ºæ¨¡-æ•°æ®åˆ†æé¢˜ | æ‚ é—²ã®å°å±‹</title>

    <link rel="stylesheet" href="/css/meme.min.css" />

    
    
        <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2/dist/instantsearch.min.js" defer></script><script src="/js/meme.min.js"></script>

    

    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto&#43;Serif&#43;SC:wght@400;500;700&amp;family=Source&#43;Code&#43;Pro:ital,wght@0,400;0,700;1,400;1,700&amp;family=Cinzel&#43;Decorative:wght@700&amp;display=swap" media="print" onload="this.media='all'" />
        <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto&#43;Serif&#43;SC:wght@400;500;700&amp;family=Source&#43;Code&#43;Pro:ital,wght@0,400;0,700;1,400;1,700&amp;family=Cinzel&#43;Decorative:wght@700&amp;display=swap" /></noscript>

    <meta name="author" content="" /><meta name="description" content="ä»…åšå‚è€ƒç”¨ï¼Œä»Šå¹´å»ºæ¨¡èµ›å‰åšå®Œè¿™ä¸ªä»£ç åï¼Œè‡ªè§‰ä¿¡å¿ƒæ»¡æ»¡ï¼Œæ¯”å®Œèµ›åç›´æ¥è£‚å¼€ï¼Œå¸Œæœ›èƒ½æ‹¿ä¸ªå›½ä¸‰å§!o(â•¥ï¹â•¥)oã€‚ 11/26 ä¸ºä»€ä¹ˆè¿˜æ²¡å…¬å¸ƒæˆç»©ï¼Œå“­æ­»ï¼Œè²Œä¼¼è¿˜æœ‰å¥½å‡ ä¸ªæ˜ŸæœŸã€‚åç»­ï¼Œè°¢è°¢å‚ä¸å¥–æğŸ˜ğŸ‘ŒğŸ˜­
â€¦â€¦" />

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#2a6df4" />
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-title" content="æ‚ é—²ã®å°å±‹" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="application-name" content="æ‚ é—²ã®å°å±‹" />
    <meta name="msapplication-starturl" content="../../" />
    <meta name="msapplication-TileColor" content="#fff" />
    <meta name="msapplication-TileImage" content="../../icons/mstile-150x150.png" />
    <link rel="manifest" href="/manifest.json" />

    
    

    
    <link rel="canonical" href="http://localhost:1313/archives/data-analysis/" />
    

<script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        "datePublished": "2022-10-16T20:58:19+00:00",
        "dateModified": "2023-09-30T11:05:47+08:00",
        "url": "http://localhost:1313/archives/data-analysis/",
        "headline": "æ•°å­¦å»ºæ¨¡-æ•°æ®åˆ†æé¢˜",
        "description": "ä»…åšå‚è€ƒç”¨ï¼Œä»Šå¹´å»ºæ¨¡èµ›å‰åšå®Œè¿™ä¸ªä»£ç åï¼Œè‡ªè§‰ä¿¡å¿ƒæ»¡æ»¡ï¼Œæ¯”å®Œèµ›åç›´æ¥è£‚å¼€ï¼Œå¸Œæœ›èƒ½æ‹¿ä¸ªå›½ä¸‰å§!o(â•¥ï¹â•¥)oã€‚ 11/26 ä¸ºä»€ä¹ˆè¿˜æ²¡å…¬å¸ƒæˆç»©ï¼Œå“­æ­»ï¼Œè²Œä¼¼è¿˜æœ‰å¥½å‡ ä¸ªæ˜ŸæœŸã€‚åç»­ï¼Œè°¢è°¢å‚ä¸å¥–æğŸ˜ğŸ‘ŒğŸ˜­\nâ€¦â€¦",
        "inLanguage" : "zh-CN",
        "articleSection": "posts",
        "wordCount":  12187 ,
        "author": {
            "@type": "Person",
            "url": "http://localhost:1313/",
            
        },
        "license": "åœ¨ä¿ç•™æœ¬æ–‡ä½œè€…åŠæœ¬æ–‡é“¾æ¥çš„å‰æä¸‹ï¼Œéå•†ä¸šç”¨é€”éšæ„è½¬è½½åˆ†äº«(æˆ‘ä¼šé«˜å¼ºåº¦è‡ªæœçš„å–”ğŸ‘Š)ã€‚",
        "publisher": {
            "@type": "Organization",
            "name": "æ‚ é—²ã®å°å±‹",
            "url": "http://localhost:1313/"
        },
        "mainEntityOfPage": {
            "@type": "WebSite",
            "@id": "http://localhost:1313/"
        }
    }
</script>

    

<meta name="twitter:card" content="summary" />


    



<meta property="og:title" content="æ•°å­¦å»ºæ¨¡-æ•°æ®åˆ†æé¢˜" />
<meta property="og:description" content="ä»…åšå‚è€ƒç”¨ï¼Œä»Šå¹´å»ºæ¨¡èµ›å‰åšå®Œè¿™ä¸ªä»£ç åï¼Œè‡ªè§‰ä¿¡å¿ƒæ»¡æ»¡ï¼Œæ¯”å®Œèµ›åç›´æ¥è£‚å¼€ï¼Œå¸Œæœ›èƒ½æ‹¿ä¸ªå›½ä¸‰å§!o(â•¥ï¹â•¥)oã€‚ 11/26 ä¸ºä»€ä¹ˆè¿˜æ²¡å…¬å¸ƒæˆç»©ï¼Œå“­æ­»ï¼Œè²Œä¼¼è¿˜æœ‰å¥½å‡ ä¸ªæ˜ŸæœŸã€‚åç»­ï¼Œè°¢è°¢å‚ä¸å¥–æğŸ˜ğŸ‘ŒğŸ˜­
â€¦â€¦" />
<meta property="og:url" content="http://localhost:1313/archives/data-analysis/" />
<meta property="og:site_name" content="æ‚ é—²ã®å°å±‹" />
<meta property="og:locale" content="zh" /><meta property="og:type" content="article" />
    <meta property="article:published_time" content="2022-10-16T20:58:19&#43;00:00" />
    <meta property="article:modified_time" content="2023-09-30T11:05:47&#43;08:00" />
    
    <meta property="article:section" content="posts" />


        <meta name="google-site-verification" content="mBjLYgXaXR8EAfTNbi4DTVC5KOJuBHpZDsmtgbgC6Rs" />

    
    

    
</head>

    <body>
        <div class="container">
            
    <header class="header">
        
            <div class="header-wrapper">
                <div class="header-inner single">
                    
    <div class="site-brand">
        
            <a href="/" class="brand">æ‚ é—²ã®å°å±‹</a>
        
    </div>

                    <nav class="nav">
    <ul class="menu" id="menu">
        
            
        
        
        
        
            
                <li class="menu-item"><a href="/categories/"><span class="menu-item-name">åˆ†ç±»</span></a>
                </li>
            
        
            
                <li class="menu-item"><a href="/tags/"><span class="menu-item-name">æ ‡ç­¾</span></a>
                </li>
            
        
            
                <li class="menu-item"><a href="/about/"><span class="menu-item-name">å…³äº</span></a>
                </li>
            
        
            
                
                    
                    
                        <li class="menu-item">
                            <a id="theme-switcher" href="#"><span class="icon theme-icon-light">ğŸŒ</span><span class="icon theme-icon-dark">ğŸŒ™</span></a>
                        </li>
                    
                
            
        
            
                <li class="menu-item search-item">
                        <form id="search" class="search" role="search">
    <label for="search-input"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon search-icon"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></label>
    <input type="search" id="search-input" class="search-input">
</form>

<template id="search-result" hidden>
    <article class="content post">
        <h2 class="post-title"><a class="summary-title-link"></a></h2>
        <summary class="summary"></summary>
        <div class="read-more-container">
            <a class="read-more-link">é˜…è¯»æ›´å¤š Â»</a>
        </div>
    </article>
</template>

                    </li>
                
            
        
    </ul>
</nav>

                    
                </div>
            </div>
            
    <input type="checkbox" id="nav-toggle" aria-hidden="true" />
    <label for="nav-toggle" class="nav-toggle"></label>
    <label for="nav-toggle" class="nav-curtain"></label>


        
    </header>




            
            
    
    <div class = "toc-wrapper">
        

    </div>
    

<main class="main single" id="main">
    <div class="main-inner">

        

        <article class="content post h-entry" data-align="justify" data-type="posts" data-toc-num="true">

            <h1 class="post-title p-name">æ•°å­¦å»ºæ¨¡-æ•°æ®åˆ†æé¢˜</h1>

            

            
                
            

            

            <nav class="contents">
  <h2 id="contents" class="contents-title">ç›®å½•</h2><ol class="toc">
    <li><a id="contents:æ•°æ®æŸ¥çœ‹" href="#æ•°æ®æŸ¥çœ‹">æ•°æ®æŸ¥çœ‹</a></li>
    <li><a id="contents:æ•°æ®é¢„å¤„ç†" href="#æ•°æ®é¢„å¤„ç†">æ•°æ®é¢„å¤„ç†</a></li>
    <li><a id="contents:ç‰¹å¾é€‰æ‹©" href="#ç‰¹å¾é€‰æ‹©">ç‰¹å¾é€‰æ‹©</a></li>
    <li><a id="contents:æ¨¡å‹å †å " href="#æ¨¡å‹å †å ">æ¨¡å‹å †å </a></li>
    <li><a id="contents:ä¸€äº›ä¿å­˜ä¸‹æ¥çš„è§£é¢˜ä»£ç " href="#ä¸€äº›ä¿å­˜ä¸‹æ¥çš„è§£é¢˜ä»£ç ">ä¸€äº›ä¿å­˜ä¸‹æ¥çš„è§£é¢˜ä»£ç </a>
      <ol>
        <li><a id="contents:q2-ä½¿ç”¨lstmé¢„æµ‹" href="#q2-ä½¿ç”¨lstmé¢„æµ‹">Q2 ä½¿ç”¨LSTMé¢„æµ‹</a></li>
        <li><a id="contents:q3" href="#q3">Q3</a></li>
        <li><a id="contents:q5-æ²¡åšå‡ºæ¥-å¥½åƒç›´æ¥è¯­æ–‡å»ºæ¨¡äº†" href="#q5-æ²¡åšå‡ºæ¥-å¥½åƒç›´æ¥è¯­æ–‡å»ºæ¨¡äº†">Q5 æ²¡åšå‡ºæ¥ å¥½åƒç›´æ¥è¯­æ–‡å»ºæ¨¡äº†</a></li>
        <li><a id="contents:q6-ç”¨æ¥lstmå’Œrnn" href="#q6-ç”¨æ¥lstmå’Œrnn">Q6 ç”¨æ¥LSTMå’ŒRNN</a></li>
      </ol>
    </li>
    <li><a id="contents:æ€»ç»“" href="#æ€»ç»“">æ€»ç»“</a></li>
  </ol>
</nav><hr></hr><div class="post-body e-content">
                <p>ä»…åšå‚è€ƒç”¨ï¼Œä»Šå¹´å»ºæ¨¡èµ›å‰åšå®Œè¿™ä¸ªä»£ç åï¼Œè‡ªè§‰ä¿¡å¿ƒæ»¡æ»¡ï¼Œæ¯”å®Œèµ›åç›´æ¥è£‚å¼€ï¼Œå¸Œæœ›èƒ½æ‹¿ä¸ªå›½ä¸‰å§!o(â•¥ï¹â•¥)oã€‚
11/26 ä¸ºä»€ä¹ˆè¿˜æ²¡å…¬å¸ƒæˆç»©ï¼Œå“­æ­»ï¼Œè²Œä¼¼è¿˜æœ‰å¥½å‡ ä¸ªæ˜ŸæœŸã€‚åç»­ï¼Œè°¢è°¢å‚ä¸å¥–æğŸ˜ğŸ‘ŒğŸ˜­</p>
<h2 id="æ•°æ®æŸ¥çœ‹"><a href="#æ•°æ®æŸ¥çœ‹" class="anchor-link">#</a><a href="#contents:æ•°æ®æŸ¥çœ‹" class="headings">æ•°æ®æŸ¥çœ‹</a></h2>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pandas_profiling</span> <span class="kn">import</span> <span class="n">ProfileReport</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl"><span class="c1"># è¶…æ…¢ å…ˆè¿è¡Œè¿™ä¸ª</span>
</span></span><span class="line"><span class="cl"><span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;C:\Users\Desktop\math&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;Molecular_Descriptor.xlsx&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">sheet_name</span> <span class="o">=</span> <span class="s1">&#39;training&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">sheet_name</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># å¦‚æœæœ‰å¤šä¸ªåˆ—å æ–¹ä¾¿èµ·è§åªå–ä¸€ä¸ª</span>
</span></span><span class="line"><span class="cl"><span class="n">profile</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">profile_report</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&#34;data_profile&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">profile</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">output_file</span><span class="o">=</span><span class="s2">&#34;analysis.html&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><h2 id="æ•°æ®é¢„å¤„ç†"><a href="#æ•°æ®é¢„å¤„ç†" class="anchor-link">#</a><a href="#contents:æ•°æ®é¢„å¤„ç†" class="headings">æ•°æ®é¢„å¤„ç†</a></h2>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># å¯¼åŒ…ç•¥è¿‡ï¼Œè‡ªè¡Œgithubçœ‹</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">describeData</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">dtypes</span><span class="p">)</span>  <span class="c1"># å¦‚æœæ˜¯objectéœ€è¦è½¬æ¢</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># for col in data:  # object to numeric if is numeric</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#     if isinstance(data[col][0], int) or isinstance(data[col][0], float):</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#         data[col] = pd.to_numeric(data[col], errors=&#39;coerce&#39;)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># print(&#39;æ•°æ®ç±»å‹ï¼š&#39;, data.dtypes)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;å‰ä¸‰è¡Œæ•°æ®ï¼š&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:</span><span class="mi">5</span><span class="p">])</span>  <span class="c1"># çœ‹çœ‹æ˜¯å¦å¯¼å…¥æ­£ç¡®</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;æ ·æœ¬æƒ…å†µ&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>  <span class="c1"># æŸ¥çœ‹æ ·æœ¬åˆ†å¸ƒ</span>
</span></span><span class="line"><span class="cl">    <span class="n">sns</span><span class="o">.</span><span class="n">displot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;åœŸå£¤è’¸å‘é‡(mm)&#39;</span><span class="p">],</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># ç›´æ–¹å›¾æŠ˜çº¿å›¾å¯è§†  !! æ³¨æ„ä¿®æ”¹æˆæŸä¸ªåˆ—å</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;picture/describe.jpg&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;10cmæ¹¿åº¦(kg/m2)&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;åœŸå£¤è’¸å‘é‡(mm)&#39;</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># 1         !! æ³¨æ„ä¿®æ”¹æˆæŸä¸ªåˆ—å</span>
</span></span><span class="line"><span class="cl">    <span class="n">data</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;10cmæ¹¿åº¦(kg/m2)&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;åœŸå£¤è’¸å‘é‡(mm)&#39;</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1666</span><span class="p">),</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;coolwarm&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># data = pd.concat([data[&#39;ALogp2&#39;], data[&#39;AMR&#39;]], axis=1)  # 1         !! å¯é€‰ç¬¬äºŒç»„å¯¹æ¯” çœ‹å®ƒä»¬ä¹‹é—´çš„ç›¸å…³æ€§ çº¿æ€§éçº¿æ€§</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># data.plot.scatter(x=&#39;ALogp2&#39;, y=&#39;AMR&#39;, ylim=(0, 1666), c=&#39;c&#39;, cmap=&#39;coolwarm&#39;)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">processNull</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># https://blog.51cto.com/liguodong/3702149</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 1. è¾“å‡ºç¼ºå¤±ç‡è¡¨æ ¼ å»ºè®®ç»“æœæ”¾åˆ°excelï¼Œå›¾å¥½çœ‹</span>
</span></span><span class="line"><span class="cl">    <span class="n">missing</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;missNum&#39;</span><span class="p">})[</span><span class="mi">1</span><span class="p">:]</span>
</span></span><span class="line"><span class="cl">    <span class="n">missing</span><span class="p">[</span><span class="s1">&#39;missRate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">missing</span><span class="p">[</span><span class="s1">&#39;missNum&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># è®¡ç®—ç¼ºå¤±æ¯”ä¾‹</span>
</span></span><span class="line"><span class="cl">    <span class="n">miss_analogy</span> <span class="o">=</span> <span class="n">missing</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;missRate&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># å‡åº</span>
</span></span><span class="line"><span class="cl">    <span class="n">miss_analogy</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">miss_analogy</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># æ’åºåé‡æ–°ä¿®æ”¹index</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;å‰å…«å˜é‡çš„ç¼ºå¤±ç‡&#39;</span><span class="p">,</span> <span class="n">miss_analogy</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>  <span class="c1"># è¾“å‡ºå‰8ä¸ª            ï¼ï¼ è§£é™¤æ³¨é‡Š</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 2. è¾“å‡ºç¼ºå¤±ç‡å›¾ å–å‰8ä¸ªéå†</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="nb">list</span><span class="p">(</span><span class="n">miss_analogy</span><span class="p">[</span><span class="s1">&#39;missRate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)[:</span><span class="mi">5</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;steelblue&#39;</span><span class="p">,</span> <span class="s1">&#39;yellow&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;å˜é‡ç¼ºå¤±ç‡ç›´æ–¹å›¾&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;å˜é‡å&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;ç¼ºå¤±ç‡&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="nb">list</span><span class="p">(</span><span class="n">miss_analogy</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">][:</span><span class="mi">5</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># plt.xticks(rotation=90)</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">miss_analogy</span><span class="p">[</span><span class="s1">&#39;missRate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[:</span><span class="mi">5</span><span class="p">])):</span>
</span></span><span class="line"><span class="cl">        <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="mf">0.02</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{:.2%}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>  <span class="c1">#å›¾ç‰‡åŠ text</span>
</span></span><span class="line"><span class="cl">        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># 3. å¤„ç†ç¼ºå¤±å€¼  åˆ é™¤ç¼ºå¤±é‡å¤§äºé˜ˆå€¼0.8</span>
</span></span><span class="line"><span class="cl">    <span class="n">orig_col</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span>  <span class="c1"># è®¾è®¡åˆ é™¤åˆ—çš„æ“ä½œæ—¶å¯ä»¥å‘ç°åˆ é™¤äº†ä»€ä¹ˆåˆ—</span>
</span></span><span class="line"><span class="cl">    <span class="n">del_col</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">thresh</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.8</span><span class="p">)</span>  <span class="c1"># åˆ é™¤åˆ—            ï¼ï¼ è§£é™¤æ³¨é‡Š</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># data = data.dropna(axis=0, how=&#39;any&#39;, thresh=data.shape[1]*0.8)  # åˆ é™¤è¡Œ</span>
</span></span><span class="line"><span class="cl">    <span class="n">data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">after_col</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span>
</span></span><span class="line"><span class="cl">    <span class="n">del_col</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">orig_col</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">after_col</span><span class="p">))))</span>  <span class="c1"># https://cloud.tencent.com/developer/article/1705131</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;åˆ é™¤ç¼ºå¤±é‡å¤§äºé˜ˆå€¼0.8çš„å˜é‡ï¼š&#39;</span><span class="p">,</span> <span class="n">del_col</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;picture/nullV.jpg&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">data</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">interpolateData</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>  <span class="c1"># å¡«å……ç¼ºå¤±å€¼</span>
</span></span><span class="line"><span class="cl">    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ç§¯é›ªæ·±åº¦(mm)&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Original Data&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 1 ç›´æ¥å¡«å……</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">     å‡å€¼é€‚ç”¨äºå®šé‡æ•°æ® èº«é«˜ å¹´é¾„ mean()
</span></span></span><span class="line"><span class="cl"><span class="s2">     ä¸­ä½æ•° æ­£æ€åˆ†å¸ƒ median()
</span></span></span><span class="line"><span class="cl"><span class="s2">     ä¼—æ•°é€‚ç”¨äºå®šæ€§æ•°æ® æ€§åˆ« æ–‡åŒ–ç¨‹åº¦ data[&#39;S-ZORB.CAL_H2.PV&#39;].mode()[0]
</span></span></span><span class="line"><span class="cl"><span class="s2">     method=&#39;pad/bfill&#39; å–å‰/åæ•°æ®å¡«å……
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># data.fillna({&#39;S-ZORB.CAL_H2.PV&#39;: data[&#39;S-ZORB.CAL_H2.PV&#39;].mean()}, inplace=True)  # åªä¿®æ”¹ä¸€åˆ—</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># data.fillna(data.mean(), inplace=True)  #           ï¼ï¼ é€‰ ç›´æ¥å¡«å…… è§£é™¤æ³¨é‡Š</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 2 æ’å€¼æ³•</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">       â€˜nearestâ€™, â€˜zeroâ€™, â€˜slinearâ€™, â€˜quadraticâ€™, â€˜cubicâ€™
</span></span></span><span class="line"><span class="cl"><span class="s2">     1.å¦‚æœä½ çš„æ•°æ®å¢é•¿é€Ÿç‡è¶Šæ¥è¶Šå¿«ï¼Œå¯ä»¥é€‰æ‹© method=&#39;quadratic&#39;äºŒæ¬¡æ’å€¼ã€‚
</span></span></span><span class="line"><span class="cl"><span class="s2">     2.å¦‚æœæ•°æ®é›†å‘ˆç°å‡ºç´¯è®¡åˆ†å¸ƒçš„æ ·å­ï¼Œæ¨èé€‰æ‹© method=&#39;pchip&#39;ã€‚
</span></span></span><span class="line"><span class="cl"><span class="s2">     3.å¦‚æœéœ€è¦å¡«è¡¥ç¼ºçœå€¼ï¼Œä»¥å¹³æ»‘ç»˜å›¾ä¸ºç›®æ ‡ï¼Œæ¨èé€‰æ‹© method=&#39;akima&#39;ã€‚
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">data</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;quadratic&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># ................ï¼ï¼ è§£é™¤æ³¨é‡Š</span>
</span></span><span class="line"><span class="cl">    <span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ç§¯é›ªæ·±åº¦(mm)&#39;</span><span class="p">],</span> <span class="s1">&#39;r--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Filled Data&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">axes</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;åˆå§‹å€¼&#39;</span><span class="p">,</span> <span class="s1">&#39;æ‹Ÿåˆå€¼&#39;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&#34;upper right&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>  <span class="c1"># ........................ï¼ï¼ è§£é™¤æ³¨é‡Š</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">data</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">processZero</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>  <span class="c1"># åˆ é™¤0å€¼å¤§äº80%çš„åˆ—/è¡Œ  Bijlsma æå‡ºçš„ 80%å‡†åˆ™</span>
</span></span><span class="line"><span class="cl">    <span class="n">zeros</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">flat</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">cnt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">flat</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">cnt</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>  <span class="c1"># è·å–0å€¼è¿‡å¤šçš„   åˆ—</span>
</span></span><span class="line"><span class="cl">            <span class="n">zeros</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;zeros error(</span><span class="si">{}</span><span class="s1">): &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">zeros</span><span class="p">)),</span> <span class="n">zeros</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">error</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">zeros</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">data</span><span class="p">[</span><span class="n">zeros</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">data_c</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">zeros</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">data</span><span class="p">[</span><span class="n">zeros</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">fig</span><span class="p">,</span> <span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data_c</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">data_c</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;æ­£å¸¸å€¼&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">error</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;0å€¼&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;ä¸‹æ ‡&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;å€¼&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">zeros</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;picture/zeroV.jpg&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">data</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">process3sigma</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>  <span class="c1"># åˆ é™¤å¼‚å¸¸å€¼ 3sigmaæ³•</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    éœ€æ»¡è¶³é«˜æ–¯åˆ†å¸ƒï¼Œå¯å‡è®¾ä¸ºé«˜æ–¯åˆ†å¸ƒå¼ºè¡Œç”¨
</span></span></span><span class="line"><span class="cl"><span class="s2">    1. å¯ä»¥åˆ é™¤æ¯åˆ—å¼‚å¸¸å€¼å¤§äºé˜ˆå€¼å¹¶ä¸”è¶…è¿‡3sigmaèŒƒå›´ï¼Œå¯¹å°‘äºé˜ˆå€¼ä½†è¶…è¿‡èŒƒå›´çš„è¿›è¡Œèµ‹å€¼ æ²¡å®ç°
</span></span></span><span class="line"><span class="cl"><span class="s2">    2. å¯ä»¥ç›´æ¥åˆ é™¤è¶…è¿‡3sigmaèŒƒå›´
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">sigma</span><span class="p">,</span> <span class="n">sigma_cnt</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">delrow_thres</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># è¡Œå¼‚å¸¸å€¼é˜ˆå€¼</span>
</span></span><span class="line"><span class="cl">    <span class="n">delcol_thres</span> <span class="o">=</span> <span class="mi">100</span>  <span class="c1"># åˆ—å¼‚å¸¸å€¼é˜ˆå€¼</span>
</span></span><span class="line"><span class="cl">    <span class="n">idx</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="n">sig</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">flat</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">flat</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">flat</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">continue</span>
</span></span><span class="line"><span class="cl">        <span class="n">flag</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>  <span class="c1"># æ£€æŸ¥å½“å‰åˆ—çš„3sigma</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">flat</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="o">-</span> <span class="n">mean</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">s</span> <span class="o">*</span> <span class="mi">3</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">sigma_cnt</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">                <span class="n">flag</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">idx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">flag</span> <span class="o">&gt;</span> <span class="n">delrow_thres</span><span class="p">:</span>  <span class="c1">#</span>
</span></span><span class="line"><span class="cl">            <span class="n">sig</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">s</span>
</span></span><span class="line"><span class="cl">            <span class="n">sigma</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># print(&#39;del 3sigma({0}) column({1}): &#39;.format(round(sig, 3), len(sigma)), sigma)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># if len(sigma) &gt; 0:</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#     draw_3sigma(data[sigma[0]])</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># draw_3sigma(data[&#39;å¹²é‡&#39;])</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># data.drop(columns=sigma, inplace=True)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># data.reset_index(drop=True)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># åˆ é™¤è¡Œ</span>
</span></span><span class="line"><span class="cl">    <span class="n">sigma_cntnp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sigma_cnt</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">where</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">sigma_cntnp</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">where</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">a</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># necessaryï¼Ÿ</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;del 3sigma row: &#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="n">idx</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">processMaxMin</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">scope</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s1">&#39;é™„ä»¶å››ï¼š354ä¸ªæ“ä½œå˜é‡ä¿¡æ¯.xlsx&#39;</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>  <span class="c1"># æ³¨æ„ä¿®æ”¹</span>
</span></span><span class="line"><span class="cl">    <span class="n">scope</span> <span class="o">=</span> <span class="n">scope</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">scope</span> <span class="o">=</span> <span class="p">{</span><span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">scope</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">scope</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="n">mm</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">        <span class="n">flag</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="ow">or</span> <span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;ï¼ˆ&#39;</span> <span class="ow">or</span> <span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;(&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">flag</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">                <span class="k">continue</span>
</span></span><span class="line"><span class="cl">            <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">mm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">if</span> <span class="n">flag</span> <span class="k">else</span> <span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">value</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\d+\.?\d*&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># æ‰¾æµ®ç‚¹æ•°</span>
</span></span><span class="line"><span class="cl">                <span class="n">mm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">if</span> <span class="n">flag</span> <span class="k">else</span> <span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="n">flag</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">mm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">mm</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;æ•°æ®error&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">scope</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">mm</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">scope</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">scope</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="ow">or</span> <span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">scope</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>  <span class="c1"># åˆ é™¤æœ€å¤§æœ€å°ä¸å¯¹çš„ è¡Œ/æ ·æœ¬</span>
</span></span><span class="line"><span class="cl">                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;minmax error&#39;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">scope</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">col</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">data</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 1. è¯»å–æ•°æ®</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># file_name = r&#39;C:\Users\Desktop\2022å¹´Eé¢˜\æ•°æ®é›†\ç›‘æµ‹ç‚¹æ•°æ®\é™„ä»¶15ï¼šè‰åŸè½®ç‰§æ”¾ç‰§æ ·åœ°ç¾¤è½ç»“æ„ç›‘æµ‹æ•°æ®é›†ï¼ˆ2016å¹´6æœˆ-2020å¹´9&#39; \</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#             r&#39;æœˆï¼‰ã€‚/å†…è’™å¤è‡ªæ²»åŒºé”¡æ—éƒ­å‹’ç›Ÿå…¸å‹è‰åŸè½®ç‰§æ”¾ç‰§æ ·åœ°ç¾¤è½ç»“æ„ç›‘æµ‹æ•°æ®é›†ï¼ˆ201.xlsx &#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;data/result.xlsx&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">sheet_name</span> <span class="o">=</span> <span class="s1">&#39;Sheet1&#39;</span>  <span class="c1"># æ³¨æ„ä¿®æ”¹</span>
</span></span><span class="line"><span class="cl">    <span class="n">table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">sheet_name</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># å¦‚æœæœ‰å¤šä¸ªåˆ—å æ–¹ä¾¿èµ·è§åªå–ä¸€ä¸ª</span>
</span></span><span class="line"><span class="cl">	<span class="c1"># 2. åˆ’åˆ†æ•°æ® if need</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># æ³¨æ„ç´¢å¼•è¿˜æ˜¯åŸæ•°æ®çš„ç´¢å¼• https://stackoverflow.com/questions/71679582/0-is-not-in-range-in-pandas</span>
</span></span><span class="line"><span class="cl">    <span class="n">sample285</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">41</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">sample285</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">sample285</span> <span class="o">=</span> <span class="n">sample285</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># é˜²æ­¢SettingWithCopyWarning</span>
</span></span><span class="line"><span class="cl">    <span class="n">sample310</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="mi">42</span><span class="p">:]</span>
</span></span><span class="line"><span class="cl">    <span class="n">sample310</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">data</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">:]</span>  <span class="c1"># æ’é™¤å¹´æœˆ</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 3. æŸ¥çœ‹æ•°æ®æƒ…å†µ</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># describeData(data)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 4. å¤„ç†ç¼ºå¤±å€¼</span>
</span></span><span class="line"><span class="cl">    <span class="n">data</span> <span class="o">=</span> <span class="n">processNull</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">data</span> <span class="o">=</span> <span class="n">processZero</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">data</span><span class="p">,</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">process3sigma</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># table = table.iloc[idx, 0]</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># data = processMaxMin(data)</span>
</span></span><span class="line"><span class="cl">    <span class="n">data</span> <span class="o">=</span> <span class="n">interpolateData</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># print(&#39;åˆ é™¤å‰å˜é‡ä¸ªæ•°&#39;, len(table.columns))</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># data.index = table.iloc[:, 0]  # å°†stringåˆ—é‡æ–°æ”¾å›</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># print(&#39;åˆ é™¤åå˜é‡ä¸ªæ•°&#39;, len(data.columns))</span>
</span></span><span class="line"><span class="cl">    <span class="n">data</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;Preprocess/pre_data.xlsx&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><h2 id="ç‰¹å¾é€‰æ‹©"><a href="#ç‰¹å¾é€‰æ‹©" class="anchor-link">#</a><a href="#contents:ç‰¹å¾é€‰æ‹©" class="headings">ç‰¹å¾é€‰æ‹©</a></h2>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span><span class="lnt">272
</span><span class="lnt">273
</span><span class="lnt">274
</span><span class="lnt">275
</span><span class="lnt">276
</span><span class="lnt">277
</span><span class="lnt">278
</span><span class="lnt">279
</span><span class="lnt">280
</span><span class="lnt">281
</span><span class="lnt">282
</span><span class="lnt">283
</span><span class="lnt">284
</span><span class="lnt">285
</span><span class="lnt">286
</span><span class="lnt">287
</span><span class="lnt">288
</span><span class="lnt">289
</span><span class="lnt">290
</span><span class="lnt">291
</span><span class="lnt">292
</span><span class="lnt">293
</span><span class="lnt">294
</span><span class="lnt">295
</span><span class="lnt">296
</span><span class="lnt">297
</span><span class="lnt">298
</span><span class="lnt">299
</span><span class="lnt">300
</span><span class="lnt">301
</span><span class="lnt">302
</span><span class="lnt">303
</span><span class="lnt">304
</span><span class="lnt">305
</span><span class="lnt">306
</span><span class="lnt">307
</span><span class="lnt">308
</span><span class="lnt">309
</span><span class="lnt">310
</span><span class="lnt">311
</span><span class="lnt">312
</span><span class="lnt">313
</span><span class="lnt">314
</span><span class="lnt">315
</span><span class="lnt">316
</span><span class="lnt">317
</span><span class="lnt">318
</span><span class="lnt">319
</span><span class="lnt">320
</span><span class="lnt">321
</span><span class="lnt">322
</span><span class="lnt">323
</span><span class="lnt">324
</span><span class="lnt">325
</span><span class="lnt">326
</span><span class="lnt">327
</span><span class="lnt">328
</span><span class="lnt">329
</span><span class="lnt">330
</span><span class="lnt">331
</span><span class="lnt">332
</span><span class="lnt">333
</span><span class="lnt">334
</span><span class="lnt">335
</span><span class="lnt">336
</span><span class="lnt">337
</span><span class="lnt">338
</span><span class="lnt">339
</span><span class="lnt">340
</span><span class="lnt">341
</span><span class="lnt">342
</span><span class="lnt">343
</span><span class="lnt">344
</span><span class="lnt">345
</span><span class="lnt">346
</span><span class="lnt">347
</span><span class="lnt">348
</span><span class="lnt">349
</span><span class="lnt">350
</span><span class="lnt">351
</span><span class="lnt">352
</span><span class="lnt">353
</span><span class="lnt">354
</span><span class="lnt">355
</span><span class="lnt">356
</span><span class="lnt">357
</span><span class="lnt">358
</span><span class="lnt">359
</span><span class="lnt">360
</span><span class="lnt">361
</span><span class="lnt">362
</span><span class="lnt">363
</span><span class="lnt">364
</span><span class="lnt">365
</span><span class="lnt">366
</span><span class="lnt">367
</span><span class="lnt">368
</span><span class="lnt">369
</span><span class="lnt">370
</span><span class="lnt">371
</span><span class="lnt">372
</span><span class="lnt">373
</span><span class="lnt">374
</span><span class="lnt">375
</span><span class="lnt">376
</span><span class="lnt">377
</span><span class="lnt">378
</span><span class="lnt">379
</span><span class="lnt">380
</span><span class="lnt">381
</span><span class="lnt">382
</span><span class="lnt">383
</span><span class="lnt">384
</span><span class="lnt">385
</span><span class="lnt">386
</span><span class="lnt">387
</span><span class="lnt">388
</span><span class="lnt">389
</span><span class="lnt">390
</span><span class="lnt">391
</span><span class="lnt">392
</span><span class="lnt">393
</span><span class="lnt">394
</span><span class="lnt">395
</span><span class="lnt">396
</span><span class="lnt">397
</span><span class="lnt">398
</span><span class="lnt">399
</span><span class="lnt">400
</span><span class="lnt">401
</span><span class="lnt">402
</span><span class="lnt">403
</span><span class="lnt">404
</span><span class="lnt">405
</span><span class="lnt">406
</span><span class="lnt">407
</span><span class="lnt">408
</span><span class="lnt">409
</span><span class="lnt">410
</span><span class="lnt">411
</span><span class="lnt">412
</span><span class="lnt">413
</span><span class="lnt">414
</span><span class="lnt">415
</span><span class="lnt">416
</span><span class="lnt">417
</span><span class="lnt">418
</span><span class="lnt">419
</span><span class="lnt">420
</span><span class="lnt">421
</span><span class="lnt">422
</span><span class="lnt">423
</span><span class="lnt">424
</span><span class="lnt">425
</span><span class="lnt">426
</span><span class="lnt">427
</span><span class="lnt">428
</span><span class="lnt">429
</span><span class="lnt">430
</span><span class="lnt">431
</span><span class="lnt">432
</span><span class="lnt">433
</span><span class="lnt">434
</span><span class="lnt">435
</span><span class="lnt">436
</span><span class="lnt">437
</span><span class="lnt">438
</span><span class="lnt">439
</span><span class="lnt">440
</span><span class="lnt">441
</span><span class="lnt">442
</span><span class="lnt">443
</span><span class="lnt">444
</span><span class="lnt">445
</span><span class="lnt">446
</span><span class="lnt">447
</span><span class="lnt">448
</span><span class="lnt">449
</span><span class="lnt">450
</span><span class="lnt">451
</span><span class="lnt">452
</span><span class="lnt">453
</span><span class="lnt">454
</span><span class="lnt">455
</span><span class="lnt">456
</span><span class="lnt">457
</span><span class="lnt">458
</span><span class="lnt">459
</span><span class="lnt">460
</span><span class="lnt">461
</span><span class="lnt">462
</span><span class="lnt">463
</span><span class="lnt">464
</span><span class="lnt">465
</span><span class="lnt">466
</span><span class="lnt">467
</span><span class="lnt">468
</span><span class="lnt">469
</span><span class="lnt">470
</span><span class="lnt">471
</span><span class="lnt">472
</span><span class="lnt">473
</span><span class="lnt">474
</span><span class="lnt">475
</span><span class="lnt">476
</span><span class="lnt">477
</span><span class="lnt">478
</span><span class="lnt">479
</span><span class="lnt">480
</span><span class="lnt">481
</span><span class="lnt">482
</span><span class="lnt">483
</span><span class="lnt">484
</span><span class="lnt">485
</span><span class="lnt">486
</span><span class="lnt">487
</span><span class="lnt">488
</span><span class="lnt">489
</span><span class="lnt">490
</span><span class="lnt">491
</span><span class="lnt">492
</span><span class="lnt">493
</span><span class="lnt">494
</span><span class="lnt">495
</span><span class="lnt">496
</span><span class="lnt">497
</span><span class="lnt">498
</span><span class="lnt">499
</span><span class="lnt">500
</span><span class="lnt">501
</span><span class="lnt">502
</span><span class="lnt">503
</span><span class="lnt">504
</span><span class="lnt">505
</span><span class="lnt">506
</span><span class="lnt">507
</span><span class="lnt">508
</span><span class="lnt">509
</span><span class="lnt">510
</span><span class="lnt">511
</span><span class="lnt">512
</span><span class="lnt">513
</span><span class="lnt">514
</span><span class="lnt">515
</span><span class="lnt">516
</span><span class="lnt">517
</span><span class="lnt">518
</span><span class="lnt">519
</span><span class="lnt">520
</span><span class="lnt">521
</span><span class="lnt">522
</span><span class="lnt">523
</span><span class="lnt">524
</span><span class="lnt">525
</span><span class="lnt">526
</span><span class="lnt">527
</span><span class="lnt">528
</span><span class="lnt">529
</span><span class="lnt">530
</span><span class="lnt">531
</span><span class="lnt">532
</span><span class="lnt">533
</span><span class="lnt">534
</span><span class="lnt">535
</span><span class="lnt">536
</span><span class="lnt">537
</span><span class="lnt">538
</span><span class="lnt">539
</span><span class="lnt">540
</span><span class="lnt">541
</span><span class="lnt">542
</span><span class="lnt">543
</span><span class="lnt">544
</span><span class="lnt">545
</span><span class="lnt">546
</span><span class="lnt">547
</span><span class="lnt">548
</span><span class="lnt">549
</span><span class="lnt">550
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">low_var_filter</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">names</span><span class="p">):</span>  <span class="c1"># ä½æ–¹å·®æ»¤æ³¢</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># äººå·¥ç‰ˆ</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># var = data.var()</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># col = var.index</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># variable = []</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># for i in range(len(var)):</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#     if var[col[i]] &lt; 1:</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#         variable.append(col[[i]].format()[0])</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># print(list(variable), var[variable[0]])</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># data.drop(columns=variable, axis=1, inplace=True)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span>  <span class="c1"># æ’é™¤timeåˆ—</span>
</span></span><span class="line"><span class="cl">    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">names</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># æ™ºèƒ½ç‰ˆ</span>
</span></span><span class="line"><span class="cl">    <span class="n">orig_col</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span>
</span></span><span class="line"><span class="cl">    <span class="n">selector</span> <span class="o">=</span> <span class="n">VarianceThreshold</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># é˜ˆå€¼ä¸º&lt;1</span>
</span></span><span class="line"><span class="cl">    <span class="n">selector</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">after_col</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">format</span><span class="p">())[</span><span class="n">selector</span><span class="o">.</span><span class="n">get_support</span><span class="p">()]</span>  <span class="c1"># è·å¾—åˆ é™¤ååˆ—</span>
</span></span><span class="line"><span class="cl">    <span class="n">del_col</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">orig_col</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">after_col</span><span class="p">)))</span>  <span class="c1"># è·å¾—åˆ é™¤åˆ—</span>
</span></span><span class="line"><span class="cl">    <span class="n">data</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ä½æ–¹å·®æ»¤æ³¢åˆ é™¤åˆ—ï¼š&#39;</span><span class="p">,</span> <span class="n">del_col</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ä½æ–¹å·®åˆ é™¤åçš„çŸ©é˜µshapeï¼š&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># data = pd.DataFrame(data, columns=after_col)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># print(data[:5])</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="n">after_col</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># data.to_excel(&#39;new_data.xlsx&#39;)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">MICSelect</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">feature_name</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">mic</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">m</span> <span class="o">=</span> <span class="n">MINE</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">m</span><span class="o">.</span><span class="n">compute_score</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">mic</span><span class="p">(),</span> <span class="mf">0.5</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># n = data.shape[1]  # ä¸¤ä¸¤æ¯”è¾ƒ https://zhuanlan.zhihu.com/p/53092905</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># result = np.zeros([n, n])</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># mine = MINE(alpha=0.6, c=15)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># for i in range(n):</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#     mine.compute_score(data[:, i], target)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#     result[i, 0] = round(mine.mic(), 2)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#     result[0, i] = round(mine.mic(), 2)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># mic = pd.DataFrame(result)</span>
</span></span><span class="line"><span class="cl">    <span class="n">SKB</span> <span class="o">=</span> <span class="n">SelectKBest</span><span class="p">(</span><span class="k">lambda</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">mic</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Y</span><span class="p">),</span> <span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="p">)))</span><span class="o">.</span><span class="n">T</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">                      <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>  <span class="c1"># é€‰æ‹©å‰kä¸ªæœ€å¥½æ¯”éœ€è¦çš„å¤š20ä¸ª https://www.cnblogs.com/nxf-rabbit75/p/11122415.html#auto-id-15</span>
</span></span><span class="line"><span class="cl">    <span class="n">SKB</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">feature_index</span> <span class="o">=</span> <span class="n">SKB</span><span class="o">.</span><span class="n">get_support</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">mic_scores</span> <span class="o">=</span> <span class="n">SKB</span><span class="o">.</span><span class="n">scores_</span>
</span></span><span class="line"><span class="cl">    <span class="n">mic_results</span> <span class="o">=</span> <span class="p">[(</span><span class="n">feature_name</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">mic_scores</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">feature_index</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">sorted_data</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">mic_results</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">pd_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">sorted_data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;å˜é‡å&#39;</span><span class="p">,</span> <span class="s1">&#39;é‡è¦æ€§åº¦&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;MICDataframe: &#39;</span><span class="p">,</span> <span class="n">pd_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">pd_data</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;FeatureSelect/MICData.xlsx&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">pd_data</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">dcorSelect</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">feature_name</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">Dcor</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">dcor</span><span class="o">.</span><span class="n">distance_correlation</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="mf">0.5</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">SKB</span> <span class="o">=</span> <span class="n">SelectKBest</span><span class="p">(</span><span class="k">lambda</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">Dcor</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Y</span><span class="p">),</span> <span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="p">)))</span><span class="o">.</span><span class="n">T</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">                      <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>  <span class="c1"># å‰kä¸ª</span>
</span></span><span class="line"><span class="cl">    <span class="n">SKB</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">feature_index</span> <span class="o">=</span> <span class="n">SKB</span><span class="o">.</span><span class="n">get_support</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">mic_scores</span> <span class="o">=</span> <span class="n">SKB</span><span class="o">.</span><span class="n">scores_</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">mic_results</span> <span class="o">=</span> <span class="p">[(</span><span class="n">feature_name</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">mic_scores</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">feature_index</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">sorted_data</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">mic_results</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">pd_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">sorted_data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;å˜é‡å&#39;</span><span class="p">,</span> <span class="s1">&#39;é‡è¦æ€§åº¦&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;DcorDataframe: &#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">pd_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">pd_data</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;FeatureSelect/DcorData.xlsx&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">pd_data</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">LassoSelect</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">feature_name</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    å­˜åœ¨ä¸€ç»„é«˜åº¦ç›¸å…³çš„ç‰¹å¾æ—¶ï¼ŒLassoå›å½’æ–¹æ³•å€¾å‘äºé€‰æ‹©å…¶ä¸­çš„ä¸€ä¸ªç‰¹å¾
</span></span></span><span class="line"><span class="cl"><span class="s2">    å…·æœ‰é«˜ç»å¯¹å€¼çš„æ•°æœ€é‡è¦
</span></span></span><span class="line"><span class="cl"><span class="s2">    https://blog.csdn.net/Kyrie_Irving/article/details/101197360
</span></span></span><span class="line"><span class="cl"><span class="s2">    https://blog.51cto.com/u_14467853/5438127
</span></span></span><span class="line"><span class="cl"><span class="s2">    http://scikit-learn.org.cn/view/199.html
</span></span></span><span class="line"><span class="cl"><span class="s2">    https://ask.hellobi.com/blog/lsxxx2011/10581
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">feature_name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">alpha_lasso</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># ä½¿ç”¨lassoCVæ‰¾å‡ºæœ€ä½³lambdaå€¼</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">StandardScaler</span><span class="p">(</span><span class="n">with_mean</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span> <span class="n">LassoCV</span><span class="p">(</span><span class="n">alphas</span><span class="o">=</span><span class="n">alpha_lasso</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">10000</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">lasso_best_alpha</span> <span class="o">=</span> <span class="n">model</span><span class="p">[</span><span class="s1">&#39;lassocv&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">alpha_</span>  <span class="c1"># å–å‡ºæœ€ä½³çš„lambdaå€¼</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;lassoå›å½’æœ€ä½³alphaå€¼&#39;</span><span class="p">,</span> <span class="n">lasso_best_alpha</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># æ ¹æ®ä¸åŒçš„lambdaç”»å‡ºå˜é‡æƒ…å†µ å¯ä»¥é¦–å…ˆå¯»æ‰¾æœ€ä¼˜å˜é‡ æ”¾è¯¥å›¾ ç„¶åæ”¾ä¸‹é¢çš„æœ€é‡è¦å˜é‡å›¾</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># lasso = Lasso()</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># coefs_lasso = []</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># for i in alpha_lasso:</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#     lasso.set_params(alpha=i)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#     lasso.fit(data, target)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#     coefs_lasso.append(lasso.coef_)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># drawPlot(alpha_lasso, coefs_lasso, title=&#39;Lassoå›å½’ç³»æ•°å’Œalphaç³»æ•°çš„å…³ç³»&#39;, xlabel=&#39;Î±å€¼&#39;, ylabel=&#39;å„å˜é‡æ¯”ä¾‹ç³»æ•°&#39;,</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#          columns=feature_name)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># ç›´æ¥ä»£å…¥æœ€ä½³å€¼</span>
</span></span><span class="line"><span class="cl">    <span class="n">lasso</span> <span class="o">=</span> <span class="n">Lasso</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">lasso_best_alpha</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">model_lasso</span> <span class="o">=</span> <span class="n">lasso</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">coef</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">model_lasso</span><span class="o">.</span><span class="n">coef_</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># print(coef[coef != 0].abs().sort_values(ascending=False)[:10])</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Lasso picked &#34;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">coef</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&#34; variables and eliminated the other &#34;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="nb">sum</span><span class="p">(</span><span class="n">coef</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&#34; variables&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">sorted_data</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">feature_name</span><span class="p">,</span> <span class="n">coef</span><span class="o">.</span><span class="n">values</span><span class="p">),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">1</span><span class="p">))[:</span><span class="n">k</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">pd_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">sorted_data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;å˜é‡å&#39;</span><span class="p">,</span> <span class="s1">&#39;é‡è¦æ€§åº¦&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;LassoDataframe: &#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">pd_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">pd_data</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;FeatureSelect/LassoData.xlsx&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">pd_data</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># useless L2æ­£åˆ™åŒ–ï¼ˆå²­å›å½’ï¼‰å¯ä»¥ç”¨æ¥åšç‰¹å¾é€‰æ‹©å—ï¼Ÿ</span>
</span></span><span class="line"><span class="cl"><span class="c1"># https://www.zhihu.com/question/288362034/answer/463287541</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">RidgeSelect</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">feature_name</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span>  <span class="c1"># æ’é™¤timeåˆ—</span>
</span></span><span class="line"><span class="cl">    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">feature_name</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span></span><span class="line"><span class="cl">    <span class="n">alpha_ridge</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># æ ¹æ®ä¸åŒçš„lambdaç”»å‡ºå˜é‡æƒ…å†µ å¯ä»¥é¦–å…ˆå¯»æ‰¾æœ€ä¼˜å˜é‡ æ”¾è¯¥å›¾ ç„¶åæ”¾ä¸‹é¢çš„æœ€é‡è¦å˜é‡å›¾</span>
</span></span><span class="line"><span class="cl">    <span class="n">ridge</span> <span class="o">=</span> <span class="n">Ridge</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">coefs_ridge</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">alpha_ridge</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">ridge</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">ridge</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">coefs_ridge</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ridge</span><span class="o">.</span><span class="n">coef_</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># https://stackoverflow.com/questions/58393378/why-does-ridge-model-fitting-show-warning-when-power-of-the-denominator-in-the-a</span>
</span></span><span class="line"><span class="cl">    <span class="n">drawPlot</span><span class="p">(</span><span class="n">alpha_ridge</span><span class="p">,</span> <span class="n">coefs_ridge</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Ridgeå›å½’ç³»æ•°å’Œalphaç³»æ•°çš„å…³ç³»&#39;</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Î±å€¼&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;å„å˜é‡æ¯”ä¾‹ç³»æ•°&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">             <span class="n">columns</span><span class="o">=</span><span class="n">feature_name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># ä½¿ç”¨lassoCVæ‰¾å‡ºæœ€ä½³lambdaå€¼</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># æ ·æœ¬æ•°æ¯”ç‰¹å¾æ•°å°‘ä¼šæŠ¥Singular matrix in solving dual problem. Using least-squares solution instead.</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">StandardScaler</span><span class="p">(</span><span class="n">with_mean</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                          <span class="n">RidgeCV</span><span class="p">(</span><span class="n">alphas</span><span class="o">=</span><span class="n">alpha_ridge</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_mean_squared_error&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">ridge_best_alpha</span> <span class="o">=</span> <span class="n">model</span><span class="p">[</span><span class="s1">&#39;ridgecv&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">alpha_</span>  <span class="c1"># å–å‡ºæœ€ä½³çš„lambdaå€¼</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ridgeå›å½’æœ€ä½³alphaå€¼&#39;</span><span class="p">,</span> <span class="n">ridge_best_alpha</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># ç›´æ¥ä»£å…¥æœ€ä½³å€¼</span>
</span></span><span class="line"><span class="cl">    <span class="n">ridge</span> <span class="o">=</span> <span class="n">Ridge</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">ridge_best_alpha</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">model_ridge</span> <span class="o">=</span> <span class="n">ridge</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">coef</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">model_ridge</span><span class="o">.</span><span class="n">coef_</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># print(coef[coef != 0].abs().sort_values(ascending=False)[:10])</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Ridge picked &#34;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">coef</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&#34; variables and eliminated the other &#34;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="nb">sum</span><span class="p">(</span><span class="n">coef</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&#34; variables&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">a</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">a</span><span class="p">[</span><span class="s1">&#39;feature&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">feature_name</span><span class="p">[:]</span>  <span class="c1"># feature_name[:45]ä½¿ç›´æ–¹å›¾å¯ä»¥æœ‰è´Ÿå€¼</span>
</span></span><span class="line"><span class="cl">    <span class="n">a</span><span class="p">[</span><span class="s1">&#39;importance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">coef</span><span class="o">.</span><span class="n">values</span>  <span class="c1"># coef.values[:45]ä½¿ç›´æ–¹å›¾å¯ä»¥æœ‰è´Ÿå€¼</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">a</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;importance&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">a</span> <span class="o">=</span> <span class="n">a</span><span class="p">[:</span><span class="mi">40</span><span class="p">]</span>  <span class="c1"># åªæ˜¾ç¤ºå‰40ä¸ªé‡è¦å˜é‡ æˆ–è€…æ³¨é‡Šæ‰</span>
</span></span><span class="line"><span class="cl">    <span class="n">drawBar</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">typ</span><span class="o">=</span><span class="s1">&#39;barh&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Ridgeæ¨¡å‹ç­›é€‰åé‡è¦å˜é‡&#39;</span><span class="p">)</span>  <span class="c1"># å–å‰40ä¸ªå˜é‡ title=&#39;Lassoæ¨¡å‹å…³è”åº¦æƒ…å†µ&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">a</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">RFSelect</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">feature_name</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    https://www.cnblogs.com/Ann21/p/11722339.html
</span></span></span><span class="line"><span class="cl"><span class="s2">    :param data:
</span></span></span><span class="line"><span class="cl"><span class="s2">    :param target:
</span></span></span><span class="line"><span class="cl"><span class="s2">    :param feature_name:
</span></span></span><span class="line"><span class="cl"><span class="s2">    :return:
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># py = Pinyin()  # é˜²æ­¢lgbmæŠ¥é”™  ä»¥ä¸‹ä¸‰è¡Œä»…åšè®°å½•ç”¨ æ— å…³RF</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># data = data.rename(columns=lambda x: py.get_pinyin(x))</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># data = data.rename(columns=lambda x: re.sub(&#39;[^A-Za-z0-9_]+&#39;, &#39;&#39;, x))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># rf = RandomForestRegressor(n_estimators=20, max_depth=4, n_jobs=7)  # ç”¨7ä¸ªæ ¸æ¥è·‘ åŠ é€Ÿ</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># scores = []</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># for i in range(data.shape[1]):  # å•å˜é‡é€‰æ‹© å¹³å‡ç²¾ç¡®ç‡å‡å°‘ è®¡ç®—å¾ˆæ…¢ å¤ªæ…¢äº† æ¢å°ç”µè„‘ä¸€èµ·è·‘</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#     score = cross_val_score(rf, data[:, i:i + 1], target, scoring=&#34;r2&#34;,</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#                             cv=ShuffleSplit(len(data)))</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#     scores.append((np.round(np.mean(score), 3), feature_name[i]))</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># keep_fea = sorted(scores, reverse=True)[:40]</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># print(keep_fea)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># drawBar(keep_fea, typ=&#39;bar&#39;)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">rf</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">rf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">sorted_data</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">feature_name</span><span class="p">,</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">rf</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">)),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                         <span class="n">key</span><span class="o">=</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">1</span><span class="p">))[:</span><span class="n">k</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">pd_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">sorted_data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;å˜é‡å&#39;</span><span class="p">,</span> <span class="s1">&#39;é‡è¦æ€§åº¦&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;RFDataframe: &#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">pd_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">pd_data</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;FeatureSelect/RFData.xlsx&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">pd_data</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">RFESelect</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># https://cloud.tencent.com/developer/article/1081618</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># https://blog.csdn.net/LuohenYJ/article/details/107239001</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># https://machinelearningmastery.com/rfe-feature-selection-in-python/</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># https://www.scikit-yb.org/en/latest/api/model_selection/rfecv.html å¯è§†åŒ– æ²¡ç”¨åˆ°</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">rank_to_dict</span><span class="p">(</span><span class="n">ranks</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">minmax</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">ranks</span> <span class="o">=</span> <span class="n">minmax</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">order</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ranks</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">ranks</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">ranks</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">ranks</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># model = SVC(kernel=&#39;linear&#39;) å¥½åƒç”¨ä¸äº†</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># model = Ridge(alpha=100000, fit_intercept=True, copy_X=True, max_iter=1500, tol=1e-4, solver=&#39;auto&#39;)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># model = LinearRegression()  # Lasso(max_iter=15000, alpha=100, scoring=&#39;r2&#39;)</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span> <span class="o">=</span> <span class="n">DecisionTreeRegressor</span><span class="p">()</span>  <span class="c1"># æ•ˆæœæ„å¤–çš„å¥½</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># model = Lasso(max_iter=15000, alpha=0.001)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># do a regress task, use the metric R-squared (coefficient of determination)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># accuracy score is used for classification problems.</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># https://stackoverflow.com/questions/32664717/got-continuous-is-not-supported-error-in-randomforestregressor</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># min_features_to_select æœ€å°‘ä¿ç•™ç‰¹å¾æ•°</span>
</span></span><span class="line"><span class="cl">    <span class="n">rfe</span> <span class="o">=</span> <span class="n">RFECV</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">min_features_to_select</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">rfe</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">ranks</span> <span class="o">=</span> <span class="n">rank_to_dict</span><span class="p">(</span><span class="n">rfe</span><span class="o">.</span><span class="n">ranking_</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">order</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">sorted_data</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">ranks</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">1</span><span class="p">))[:</span><span class="n">k</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">pd_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">sorted_data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;å˜é‡å&#39;</span><span class="p">,</span> <span class="s1">&#39;é‡è¦æ€§åº¦&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;RFEDataframe: &#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">pd_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">pd_data</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;FeatureSelect/RFEData.xlsx&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">pd_data</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">PCAReduction</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    https://stackoverflow.com/questions/50796024/feature-variable-importance-after-a-pca-analysis
</span></span></span><span class="line"><span class="cl"><span class="s2">    https://cloud.tencent.com/developer/article/1794827
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">scaler</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">X</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># pca = PCA(n_components=&#39;mle&#39;, svd_solver=&#39;full&#39;)  # pca guess the dimension</span>
</span></span><span class="line"><span class="cl">    <span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># !                     çœ‹æƒ…å†µä¿®æ”¹</span>
</span></span><span class="line"><span class="cl">    <span class="n">x_new</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">n_pcs</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">components_</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">most_important</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">pca</span><span class="o">.</span><span class="n">components_</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_pcs</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">    <span class="n">most_important_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="n">most_important</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_pcs</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># ç”»å›¾</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># drawBiplot(x_new[:, :], np.transpose(pca.components_[:, most_important]), y, labels=most_important_names)</span>
</span></span><span class="line"><span class="cl">    <span class="n">dic</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;PC</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">):</span> <span class="n">most_important_names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_pcs</span><span class="p">)}</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dic</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;evr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">pca</span><span class="o">.</span><span class="n">explained_variance_ratio_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_pcs</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ä¸»æˆåˆ†&#39;</span><span class="p">,</span> <span class="s1">&#39;è¯¥ä¸»æˆåˆ†ä¸‹æœ€é‡è¦çš„å˜é‡&#39;</span><span class="p">,</span> <span class="s1">&#39;ä¸»æˆåˆ†è§£é‡Šç‡&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># æ¯ä¸ªä¸»æˆåˆ†æœ€ä¼˜å˜é‡å’Œè¯¥ä¸»æˆåˆ†çš„ä»·å€¼</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># è¾“å‡ºæ¯ä¸ªä¸»æˆåˆ†æŒ‰kæ¯”ä¾‹ä¸ªå˜é‡</span>
</span></span><span class="line"><span class="cl">    <span class="n">n_pcs_best</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># éœ€è¦æ ¹æ®dfæ¥åˆ¤æ–­</span>
</span></span><span class="line"><span class="cl">    <span class="n">sel</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">k</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">4</span><span class="p">),</span> <span class="n">k</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">k</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">    <span class="n">K_important</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_pcs_best</span><span class="p">):</span>  <span class="c1"># å–ç¬¬iä¸ªä¸»æˆåˆ†çš„æ’åºåcomponentçš„ä¸‹æ ‡</span>
</span></span><span class="line"><span class="cl">        <span class="n">comp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">pca</span><span class="o">.</span><span class="n">components_</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">argsort</span><span class="p">()[::</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="n">sel</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl">        <span class="n">K_important</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">K_important_names</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_pcs_best</span><span class="p">):</span>  <span class="c1"># æœ€å¥½çš„å‡ ä¸ªä¸»æˆåˆ†</span>
</span></span><span class="line"><span class="cl">        <span class="n">temp</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">        <span class="n">component</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">components_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">K_important</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>  <span class="c1"># æ¯ä¸ªä¸»æˆåˆ†æŒ‰è´¡çŒ®ç‡å–å‰jä¸ªå€¼</span>
</span></span><span class="line"><span class="cl">            <span class="n">temp</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">names</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">component</span><span class="p">[</span><span class="n">j</span><span class="p">])))</span>
</span></span><span class="line"><span class="cl">        <span class="n">K_important_names</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;å‰2ä¸ªä¸»æˆåˆ†ä¹‹å‰Kä¸ªå˜é‡é‡è¦æ€§&#39;</span><span class="p">,</span> <span class="n">K_important_names</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">pd_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">K_important_names</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;å˜é‡å&#39;</span><span class="p">,</span> <span class="s1">&#39;é‡è¦æ€§åº¦&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;PCADataframe: &#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">pd_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">pd_data</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;FeatureSelect/PCAData.xlsx&#39;</span><span class="p">)</span>  <span class="c1"># è¦np.absæ‰ ä¿å­˜å—</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">pd_data</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">voteFeature</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">voteSum</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">new_data</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">top</span> <span class="o">=</span> <span class="n">k</span>  <span class="c1"># é€‰å®šçš„å˜é‡æ•°k</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;å˜é‡å&#39;</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">            <span class="n">new_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">top</span>
</span></span><span class="line"><span class="cl">            <span class="n">top</span> <span class="o">-=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">top</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">top</span> <span class="o">=</span> <span class="n">k</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">new_data</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">file_dic</span> <span class="o">=</span> <span class="s1">&#39;FeatureSelect/&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">MIC_list</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">file_dic</span> <span class="o">+</span> <span class="s1">&#39;MICData.xlsx&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">dcor_list</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">file_dic</span> <span class="o">+</span> <span class="s1">&#39;DcorData.xlsx&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">lasso_list</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">file_dic</span> <span class="o">+</span> <span class="s1">&#39;LassoData.xlsx&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">RF_list</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">file_dic</span> <span class="o">+</span> <span class="s1">&#39;RFData.xlsx&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">RFE_list</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">file_dic</span> <span class="o">+</span> <span class="s1">&#39;RFEData.xlsx&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">pca_list</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">file_dic</span> <span class="o">+</span> <span class="s1">&#39;PCAData.xlsx&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">all_list</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">MIC_list</span><span class="p">,</span> <span class="n">dcor_list</span><span class="p">,</span> <span class="n">lasso_list</span><span class="p">,</span> <span class="n">RF_list</span><span class="p">,</span> <span class="n">RFE_list</span><span class="p">,</span> <span class="n">pca_list</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">all_list</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">file_dic</span> <span class="o">+</span> <span class="s1">&#39;all.xlsx&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">new_list</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">new_list</span> <span class="o">=</span> <span class="n">voteSum</span><span class="p">(</span><span class="n">all_list</span><span class="p">,</span> <span class="n">new_list</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">sorted_dic</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">new_list</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">sorted_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sorted_dic</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;æœ€ç»ˆçš„å‰</span><span class="si">{}</span><span class="s1">ä¸ªå˜é‡ï¼š&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">sorted_list</span><span class="p">[:</span><span class="n">k</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">sorted_dic</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">sorted_list</span><span class="p">[:</span><span class="n">k</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">corrSelect</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    https://www.cnblogs.com/always-fight/p/10209213.html
</span></span></span><span class="line"><span class="cl"><span class="s2">    çš®å°”é€Šç³»æ•°åªèƒ½è¡¡é‡çº¿æ€§ç›¸å…³æ€§ï¼Œå…ˆè¦è®¡ç®—å„ä¸ªç‰¹å¾å¯¹ç›®æ ‡å€¼çš„ç›¸å…³ç³»æ•°ä»¥åŠç›¸å…³ç³»æ•°çš„På€¼ã€‚
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">names</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">c</span> <span class="o">=</span> <span class="n">cal_c</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">n_clusters</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>  <span class="c1"># åœ¨utilsæ–‡ä»¶ä¸­</span>
</span></span><span class="line"><span class="cl">    <span class="n">c</span><span class="o">.</span><span class="n">corr_heat_map</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">del_col</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">drop_hight_corr</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">get_col</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">names</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">del_col</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">get_col</span>
</span></span><span class="line"><span class="cl">	<span class="c1"># æ­¤å¤„æ‰‹åŠ¨ç‰ˆè·å¾—på€¼ å¹¶æ ¹æ®é˜ˆå€¼0.8 0.001ç­›é€‰ç‰¹å¾ æ²¡ç”¨åˆ°</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># sav = []</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># for i in range(data.shape[1]):  # éå†ç‰¹å¾</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#     temp = []</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#     for j in range(i, data.shape[1]):</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#         if j == i:</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#             continue</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#         ret = pearsonr(data[:, i], data[:, j])</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#         if abs(ret[0]) &lt; 0.8 and ret[1] &lt; 0.001:</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#             temp.append(j)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#     if len(temp) &gt; int(data.shape[1] * 0.5):</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#         sav.append(i)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#     # results.append(&#39; &#39;)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># p_result = list(set(sav))</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># print(p_result, len(p_result))</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># return p_result</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># def multivariate_pearsonr(X, y):</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#     scores, p_values = [], []</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#     for ret in map(lambda x: pearsonr(x, y), X.T):</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#         if abs(ret[0]) &lt;= 0.6:</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#             scores.append(abs(ret[0]))</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#             p_values.append(ret[1])</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#         else:</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#             scores.append(0)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#     return np.array(scores), 0</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># def multivariate_spearmanr(X, y):</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#     scores, p_values = [], []</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#     for ret in map(lambda x: spearmanr(x, y), X.T):</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#         if abs(ret[0]) &lt;= 0.6:</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#             scores.append(abs(ret[0]))</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#             p_values.append(ret[1])</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#         else:</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#             scores.append(0)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#     return np.array(scores), 0</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># transformer = SelectKBest(score_func=multivariate_pearsonr, k=k)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># transformer.fit_transform(data, target)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># feature_index = transformer.get_support(True)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># p_results = [names[i] for i in feature_index]</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># # return p_results</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># æ­¤å¤„è‡ªåŠ¨ç‰ˆè·å–å‰kä¸ª æ ¹æ®på€¼</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># transformer = SelectKBest(score_func=multivariate_spearmanr, k=k)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># transformer.fit_transform(data, target)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># feature_index = transformer.get_support(True)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># s_results = [names[i] for i in feature_index]</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># return s_results</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">high_corr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">names</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">kendall_pval</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="n">kendalltau</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">pearsonr_pval</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">spearmanr_pval</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="n">spearmanr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># https://zhuanlan.zhihu.com/p/34717666</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># data = data.drop(&#39;å› å˜é‡&#39;, 1) load_dataå·²ç»æ’é™¤</span>
</span></span><span class="line"><span class="cl">    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">names</span><span class="p">)</span>  <span class="c1"># åˆ©ç”¨é«˜ç›¸å…³åˆ é™¤ç‰¹å¾</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># https://blog.csdn.net/sunmingyang1987/article/details/105459104</span>
</span></span><span class="line"><span class="cl">    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># è¿ç»­ã€æ­£æ€åˆ†å¸ƒã€çº¿æ€§ è¡¡é‡ä¸¤ä¸ªæ•°æ®æ˜¯å¦åœ¨ä¸€æ¡çº¿ä¸Š</span>
</span></span><span class="line"><span class="cl">    <span class="n">p_cor</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">draw_heatmap</span><span class="p">(</span><span class="n">p_cor</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;çš®å°”æ£®ç›¸å…³ç³»æ•°&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># p_value = data.corr(method=pearsonr_pval)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># p_value = p_value[p_value &lt; 0.001]</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># p_value = p_value.iloc[:15, :15]</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># draw_heatmap(p_value, method=&#39;çš®å°”æ£®ç›¸å…³ç³»æ•°På€¼&#39;, center=0.001)  # æ²¡ç”¨åˆ°</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># data_store(p_cor, &#39;pearson&#39;)  # ä¿å­˜æ•°æ®</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># # é’ˆå¯¹æ— åºåºåˆ—çš„ç›¸å…³ç³»æ•°ï¼Œéæ­£å¤ªåˆ†å¸ƒçš„æ•°æ® ç”¨åœ¨åˆ†ç±»ä¸Šã€æ— åº</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># k_cor = data.corr(method=&#39;kendall&#39;)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># draw_cor = k_cor.iloc[:15, :15]</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># draw_heatmap(draw_cor, method=&#39;è‚¯å¾·å°”ç›¸å…³ç³»æ•°&#39;)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># k_value = data.corr(method=kendall_pval)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># k_value = k_value[k_value &lt; 0.001]</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># k_value = k_value.iloc[:15, :15]</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># draw_heatmap(k_value, method=&#39;è‚¯å¾·å°”ç›¸å…³ç³»æ•°På€¼&#39;, center=0.001)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># data_store(p_cor, &#39;kendall&#39;)  # ä¿å­˜æ•°æ®</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># éçº¿æ€§çš„ã€éæ­£æ€ å¯¹åŸå§‹å˜é‡çš„åˆ†å¸ƒä¸åšè¦æ±‚</span>
</span></span><span class="line"><span class="cl">    <span class="n">s_cor</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;spearman&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">draw_heatmap</span><span class="p">(</span><span class="n">s_cor</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;æ–¯çš®å°”æ›¼ç›¸å…³ç³»æ•°&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># s_value = data.corr(method=spearmanr_pval)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># s_value = s_value[s_value &lt; 0.001]</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># s_value = s_value.iloc[:15, :15]</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># draw_heatmap(s_value, method=&#39;æ–¯çš®å°”æ›¼ç›¸å…³ç³»æ•°På€¼&#39;, center=0.001)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># data_store(p_cor, &#39;spearman&#39;)  # ä¿å­˜æ•°æ®</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">featureSelect</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>  <span class="c1"># çœ‹åˆ°è¿™é‡Œå‘ç°æ²¡æœ‰ä¿å­˜æœ€ç»ˆç‰ˆ åªèƒ½å°†å°±æ”¹äº†</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">SelIndex</span><span class="p">(</span><span class="n">list1</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">index</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list1</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">names</span><span class="p">))</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="n">index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">index</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># æ ‡å‡†åŒ–å¯èƒ½ä¼šå¯¼è‡´å€¼å˜0 å»ºè®®ä¸æ ‡å‡†åŒ–</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># scaler = StandardScaler()</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># data = scaler.fit_transform(data)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># data_ = scaler.inverse_transform(data)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># data_new = data_[:, target_new]  # å°†æ ‡å‡†åŒ–æ•°æ®è¿˜åŸ</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># target = scaler.fit_transform(target)</span>
</span></span><span class="line"><span class="cl">    <span class="n">target</span> <span class="o">=</span> <span class="n">target</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># è¿‡æ»¤æ³•</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># æœ€å¤§ä¿¡æ¯ç³»æ•°</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># MIC_list = MICSelect(data, target, names, k)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># drawBar(MIC_list, &#39;æœ€å¤§ä¿¡æ¯ç³»æ•°&#39;)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># è·ç¦»ç›¸å…³ç³»æ•°</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># dcor_list = dcorSelect(data, target, names, k)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># drawBar(dcor_list, &#39;è·ç¦»ç›¸å…³ç³»æ•°&#39;)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># åµŒå…¥æ³•</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Lassoå›å½’</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># lasso_list = LassoSelect(data, target, names, k)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># ä¸æ’åºç›´æ¥å–å‰kä¸ªå˜é‡ title=&#39;Lassoæ¨¡å‹å…³è”åº¦æƒ…å†µ&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># drawBar(lasso_list, typ=&#39;bar&#39;, title=&#39;Lassoæ¨¡å‹å˜é‡é‡è¦æ€§&#39;, xlabel=&#39;å˜é‡å&#39;, ylabel=&#39;é‡è¦æ€§&#39;)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># éšæœºæ£®æ—</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># RF_list = RFSelect(data, target, names, k)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># drawBar(RF_list, title=&#39;éšæœºæ£®æ—æ¨¡å‹å˜é‡é‡è¦æ€§&#39;)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># åŒ…è£…æ³• RFE</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># RFE_list = RFESelect(data, target, names, k)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># drawBar(RFE_list, title=&#39;RFEæ¨¡å‹å˜é‡é‡è¦æ€§&#39;)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># æ•°æ®é™ç»´</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># pca_list = PCAReduction(data, names, k)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># drawBar(pca_list, title=&#39;PCAæ¨¡å‹å˜é‡é‡è¦æ€§&#39;)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">after_list</span> <span class="o">=</span> <span class="n">voteFeature</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">after_index</span> <span class="o">=</span> <span class="n">SelIndex</span><span class="p">(</span><span class="n">after_list</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ç»è¿‡å…­ç§ç‰¹å¾é€‰æ‹©åçš„å˜é‡ä¸‹æ ‡: &#39;</span><span class="p">,</span> <span class="n">after_index</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># high_corr(data[:, after_index], target, names[after_index])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">final_list</span> <span class="o">=</span> <span class="n">corrSelect</span><span class="p">(</span><span class="n">data</span><span class="p">[:,</span> <span class="n">after_index</span><span class="p">],</span> <span class="n">target</span><span class="p">,</span> <span class="n">names</span><span class="p">[</span><span class="n">after_index</span><span class="p">],</span> <span class="n">k</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">final_index</span> <span class="o">=</span> <span class="n">final_list</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ç»è¿‡ç›¸å…³æ€§å¤„ç†åçš„å˜é‡ä¸‹æ ‡: &#39;</span><span class="p">,</span> <span class="n">final_index</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">high_corr</span><span class="p">(</span><span class="n">data</span><span class="p">[:,</span> <span class="n">final_index</span><span class="p">],</span> <span class="n">target</span><span class="p">,</span> <span class="n">names</span><span class="p">[</span><span class="n">final_index</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># è¯„ä»·æ˜¯ä¸¤ä¸ªäº‹ä»¶æ˜¯å¦ç‹¬ç«‹ https://www.cnblogs.com/always-fight/p/10209213.html  ä»¥ä¸‹ä¸‰è¡Œä»…åšè®°å½•</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># X_new = SelectKBest(chi2, k=k).fit_transform(X, y) ç±»åˆ«å‹å˜é‡å¯¹ç±»åˆ«å‹å˜é‡çš„ç›¸å…³æ€§</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># https://scikit-learn.org/stable/modules/model_evaluation.html#scoring-parameter</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># scores = cross_val_score(RFC, X, Y, cv=5, scoring=&#39;accuracy&#39;)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">featureSelect2</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">SelIndex</span><span class="p">(</span><span class="n">list1</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">index</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list1</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">names</span><span class="p">))</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="n">index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">index</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">after_list</span> <span class="o">=</span> <span class="n">corrSelect</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;spearman&#39;</span><span class="p">)</span>  <span class="c1"># è®°å¾—ä¿®æ”¹é˜ˆå€¼</span>
</span></span><span class="line"><span class="cl">    <span class="n">after_index</span> <span class="o">=</span> <span class="n">SelIndex</span><span class="p">(</span><span class="n">after_list</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ç»è¿‡ç›¸å…³æ€§å¤„ç†åçš„å˜é‡ä¸‹æ ‡(</span><span class="si">{}</span><span class="s1">): &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">after_index</span><span class="p">)),</span> <span class="n">after_index</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># high_corr(data[:, after_index], names[after_index])</span>
</span></span><span class="line"><span class="cl">    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="n">after_index</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">names</span> <span class="o">=</span> <span class="n">names</span><span class="p">[</span><span class="n">after_index</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># è¿‡æ»¤æ³•</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># æœ€å¤§ä¿¡æ¯ç³»æ•°</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># MIC_list = MICSelect(data, target, names, k)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># drawBar(MIC_list, &#39;æœ€å¤§ä¿¡æ¯ç³»æ•°&#39;)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># è·ç¦»ç›¸å…³ç³»æ•°</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># dcor_list = dcorSelect(data, target, names, k)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># drawBar(dcor_list, &#39;è·ç¦»ç›¸å…³ç³»æ•°&#39;)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># åµŒå…¥æ³•</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Lassoå›å½’ ä¸æ’åºç›´æ¥å–å‰kä¸ªå˜é‡ title=&#39;Lassoæ¨¡å‹å…³è”åº¦æƒ…å†µ&#39; ä¼šå‡ºç°è´Ÿå€¼ æ˜¾å¾—è·Ÿå…¶ä»–å›¾ç‰‡ä¸ä¸€æ · æœ‰åŒºåˆ«æ€§</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># lasso_list = LassoSelect(data, target, names, k)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># drawBar(lasso_list, title=&#39;Lassoæ¨¡å‹å˜é‡é‡è¦æ€§&#39;, xlabel=&#39;å˜é‡å&#39;, ylabel=&#39;é‡è¦æ€§&#39;)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># éšæœºæ£®æ—</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># RF_list = RFSelect(data, target, names, k)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># drawBar(RF_list, title=&#39;éšæœºæ£®æ—æ¨¡å‹å˜é‡é‡è¦æ€§&#39;)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># åŒ…è£…æ³• RFE  ç”¨æ ‡å‡†åŒ–æ•°æ®</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># æ ‡å‡†åŒ–å¯èƒ½ä¼šå¯¼è‡´å€¼å˜0 å»ºè®®ä¸æ ‡å‡†åŒ–</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># target = target.reshape(1, -1)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># scaler = StandardScaler()</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># data = scaler.fit_transform(data)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># data_ = scaler.inverse_transform(data)  # å°†æ ‡å‡†åŒ–æ•°æ®è¿˜åŸ</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># target = scaler.fit_transform(target)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># target = target[0, :]</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># RFE_list = RFESelect(data, target, names, k)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># drawBar(RFE_list, title=&#39;RFEæ¨¡å‹å˜é‡é‡è¦æ€§&#39;)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># data = data_</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># æ•°æ®é™ç»´</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># éœ€è¦æ³¨æ„çš„æ˜¯è™½ç„¶æœ‰è´Ÿå€¼ ä½†æ˜¯é‡è¦æ€§çœ‹çš„æ˜¯ç»å¯¹å€¼</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># pca_list = PCAReduction(data, names, k)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># drawBar(pca_list, title=&#39;PCAæ¨¡å‹å˜é‡é‡è¦æ€§&#39;)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#</span>
</span></span><span class="line"><span class="cl">    <span class="n">final_list</span> <span class="o">=</span> <span class="n">voteFeature</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">final_index</span> <span class="o">=</span> <span class="n">SelIndex</span><span class="p">(</span><span class="n">final_list</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ç»è¿‡å…­ç§ç‰¹å¾é€‰æ‹©åçš„å˜é‡ä¸‹æ ‡(</span><span class="si">{}</span><span class="s1">): &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">final_index</span><span class="p">)),</span> <span class="n">final_index</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># high_corr(data[:, final_index], names[final_index])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">[:,</span> <span class="n">final_index</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="n">names</span><span class="p">[</span><span class="n">final_index</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">result</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;FeatureSelect/results.xlsx&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">result</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;C:/Users/Desktop/æ•°æ¨¡é¢˜/é™„ä»¶ä¸€ï¼š325ä¸ªæ ·æœ¬æ•°æ®.xlsx&#39;</span>  <span class="c1"># åˆ—åå–ä¸­æ–‡å</span>
</span></span><span class="line"><span class="cl">    <span class="n">sheet_name</span> <span class="o">=</span> <span class="s1">&#39;Sheet1&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># table = pd.read_excel(file_name, sheet_name, header=[2])  # å¦‚æœæœ‰å¤šä¸ªåˆ—å æ–¹ä¾¿èµ·è§åªå–ä¸€ä¸ª</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># table = table.iloc[:, 2:]</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># table.rename(columns={&#39;æ—¶é—´&#39;: &#39;time&#39;}, inplace=True)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># print(table.head())</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># https://zhuanlan.zhihu.com/p/98729226 D21116460003</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># plt.style.use(&#39;fivethirtyeight&#39;)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># seaborn.pairplot(table, vars=table.columns[:8], diag_kind=&#39;kde&#39;)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># plt.show()</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">loadData2</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">X</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">low_var_filter</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>  <span class="c1"># ä½æ–¹å·®æ»¤æ³¢ æºå¸¦ä¿¡æ¯å°‘</span>
</span></span><span class="line"><span class="cl">    <span class="n">high_corr</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([])</span>
</span></span><span class="line"><span class="cl">    <span class="n">t_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;10cmæ¹¿åº¦(kg/m2)&#39;</span><span class="p">,</span> <span class="s1">&#39;40cmæ¹¿åº¦(kg/m2)&#39;</span><span class="p">,</span> <span class="s1">&#39;100cmæ¹¿åº¦(kg/m2)&#39;</span><span class="p">,</span> <span class="s1">&#39;200cmæ¹¿åº¦(kg/m2)&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
</span></span><span class="line"><span class="cl">        <span class="n">temp</span> <span class="o">=</span> <span class="n">Y</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#     # result = featureSelect(X, temp, name, k=10)  # åå»ç›¸å…³</span>
</span></span><span class="line"><span class="cl">        <span class="n">result</span> <span class="o">=</span> <span class="n">featureSelect2</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>  <span class="c1"># å…ˆå»ç›¸å…³</span>
</span></span><span class="line"><span class="cl">        <span class="k">break</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#     results = pd.concat([results, result], axis=1)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#     print(results.iloc[1, :])</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># results.to_excel(&#39;data/results.xlsx&#39;)</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><h2 id="æ¨¡å‹å †å "><a href="#æ¨¡å‹å †å " class="anchor-link">#</a><a href="#contents:æ¨¡å‹å †å " class="headings">æ¨¡å‹å †å </a></h2>
<p>è¿™é‡Œå°±ä¸ç»™äº† å› ä¸ºæˆ‘æ²¡å†™è¿™é‡Œçš„ä»£ç ï¼Œå®é™…ä¸Šå°±æ˜¯sklearnè°ƒç”¨å¾ˆå¤šæ–¹æ³•ï¼Œæ³¨æ„è°ƒå‚ï¼Œå¯èƒ½ç»“æœä¸å¥½çš„åŸå› æ˜¯ç‰¹å¾é€‰æ‹©ä¸å¥½æˆ–è€…æ¨¡å‹ä¸å¯¹ï¼Œå»ºè®®å¤šå‡†å¤‡ä¸€äº›ï¼Œæ¯”å¦‚åˆ†ç±»æ¨¡å‹ã€å›å½’æ¨¡å‹ã€è‡ªå›å½’æ¨¡å‹ã€æ—¶é—´åºåˆ—ã€æ·±åº¦å­¦ä¹ æ¨¡å‹ã€‚</p>
<h2 id="ä¸€äº›ä¿å­˜ä¸‹æ¥çš„è§£é¢˜ä»£ç "><a href="#ä¸€äº›ä¿å­˜ä¸‹æ¥çš„è§£é¢˜ä»£ç " class="anchor-link">#</a><a href="#contents:ä¸€äº›ä¿å­˜ä¸‹æ¥çš„è§£é¢˜ä»£ç " class="headings">ä¸€äº›ä¿å­˜ä¸‹æ¥çš„è§£é¢˜ä»£ç </a></h2>
<h3 id="q2-ä½¿ç”¨lstmé¢„æµ‹"><a href="#q2-ä½¿ç”¨lstmé¢„æµ‹" class="anchor-link">#</a><a href="#contents:q2-ä½¿ç”¨lstmé¢„æµ‹" class="headings">Q2 ä½¿ç”¨LSTMé¢„æµ‹</a></h3>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">math</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">keras.losses</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.sans-serif&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SimHei&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.unicode_minus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl"><span class="n">file_dic</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;C:\Users\Desktop\2022å¹´Eé¢˜\æ•°æ®é›†\åŸºæœ¬æ•°æ®/&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">file_name</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;é™„ä»¶3ã€åœŸå£¤æ¹¿åº¦2022â€”2012å¹´.xlsx&#39;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># dataset_train = pd.read_excel(file_dic + file_name, usecols=[&#39;10cmæ¹¿åº¦(kg/m2)&#39;], sheet_name=&#39;sheet1&#39;)</span>
</span></span><span class="line"><span class="cl"><span class="n">dataset_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">file_dic</span> <span class="o">+</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;10cmæ¹¿åº¦(kg/m2)&#39;</span><span class="p">],</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;sheet1&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># dataset_train = dataset_train.sort_values(by=&#39;Date&#39;).reset_index(drop=True)</span>
</span></span><span class="line"><span class="cl"><span class="n">training_set</span> <span class="o">=</span> <span class="n">dataset_train</span><span class="o">.</span><span class="n">values</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">dataset_train</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">sc</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">(</span><span class="n">feature_range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">training_set_scaled</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">training_set</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># æ¯æ¡æ ·æœ¬å«60ä¸ªæ—¶é—´æ­¥ï¼Œå¯¹åº”ä¸‹ä¸€æ—¶é—´æ­¥çš„æ ‡ç­¾å€¼</span>
</span></span><span class="line"><span class="cl"><span class="n">X_train</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl"><span class="n">y_train</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">93</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">X_train</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">training_set_scaled</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">6</span><span class="p">:</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">y_train</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">training_set_scaled</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">X_train</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y_train</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">y_train</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Reshaping</span>
</span></span><span class="line"><span class="cl"><span class="n">X_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">keras.models</span> <span class="kn">import</span> <span class="n">Sequential</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">keras.layers</span> <span class="kn">import</span> <span class="n">Dense</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">keras.layers</span> <span class="kn">import</span> <span class="n">SimpleRNN</span><span class="p">,</span> <span class="n">LSTM</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">keras.layers</span> <span class="kn">import</span> <span class="n">Dropout</span>
</span></span><span class="line"><span class="cl"><span class="c1"># print(X_train.shape[1])</span>
</span></span><span class="line"><span class="cl"><span class="c1"># åˆå§‹åŒ–é¡ºåºæ¨¡å‹</span>
</span></span><span class="line"><span class="cl"><span class="n">regressor</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="c1"># å®šä¹‰è¾“å…¥å±‚åŠå¸¦5ä¸ªç¥ç»å…ƒçš„éšè—å±‚</span>
</span></span><span class="line"><span class="cl"><span class="n">regressor</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">SimpleRNN</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl"><span class="c1"># å®šä¹‰çº¿æ€§çš„è¾“å‡ºå±‚</span>
</span></span><span class="line"><span class="cl"><span class="n">regressor</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="c1"># æ¨¡å‹ç¼–è¯‘ï¼šå®šä¹‰ä¼˜åŒ–ç®—æ³•adamï¼Œ ç›®æ ‡å‡½æ•°å‡æ–¹æ ¹MSE</span>
</span></span><span class="line"><span class="cl"><span class="n">regressor</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;sgd&#39;</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;mean_squared_error&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># æ¨¡å‹è®­ç»ƒ</span>
</span></span><span class="line"><span class="cl"><span class="n">history</span> <span class="o">=</span> <span class="n">regressor</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">validation_split</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">regressor</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;loss&#39;</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;è®­ç»ƒé›†æŸå¤±&#39;</span><span class="p">)</span>  <span class="c1"># è“è‰²çº¿è®­ç»ƒé›†æŸå¤±</span>
</span></span><span class="line"><span class="cl"><span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;val_loss&#39;</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;éªŒè¯é›†æŸå¤±&#39;</span><span class="p">)</span>  <span class="c1"># çº¢è‰²çº¿éªŒè¯é›†æŸå¤±</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;å€¼&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;è¿­ä»£æ¬¡æ•°&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="c1"># æµ‹è¯•æ•°æ®</span>
</span></span><span class="line"><span class="cl"><span class="c1"># dataset_test = pd.read_csv(&#39;./data/tatatest.csv&#39;)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># dataset_test = pd.read_excel(file_dic + r&#39;é™„ä»¶3ã€åœŸå£¤æ¹¿åº¦2022â€”2012å¹´test.xlsx&#39;, usecols=[&#39;10cmæ¹¿åº¦(kg/m2)&#39;], sheet_name=&#39;sheet1&#39;)</span>
</span></span><span class="line"><span class="cl"><span class="n">dataset_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">file_dic</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39;é™„ä»¶3ã€åœŸå£¤æ¹¿åº¦2022â€”2012å¹´test.xlsx&#39;</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;10cmæ¹¿åº¦(kg/m2)&#39;</span><span class="p">],</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;sheet1&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">real_value</span> <span class="o">=</span> <span class="n">dataset_test</span><span class="p">[</span><span class="s1">&#39;10cmæ¹¿åº¦(kg/m2)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">dataset_total</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">dataset_train</span><span class="p">[</span><span class="s1">&#39;10cmæ¹¿åº¦(kg/m2)&#39;</span><span class="p">],</span> <span class="n">dataset_test</span><span class="p">[</span><span class="s1">&#39;10cmæ¹¿åº¦(kg/m2)&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">inputs</span> <span class="o">=</span> <span class="n">dataset_total</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">dataset_total</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataset_test</span><span class="p">)</span> <span class="o">-</span> <span class="mi">60</span><span class="p">:]</span><span class="o">.</span><span class="n">values</span>
</span></span><span class="line"><span class="cl"><span class="n">inputs</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">inputs</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æå–æµ‹è¯•é›†</span>
</span></span><span class="line"><span class="cl"><span class="n">X_test</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">30</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">X_test</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inputs</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">6</span><span class="p">:</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">X_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">X_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="p">(</span><span class="n">X_test</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æ¨¡å‹é¢„æµ‹</span>
</span></span><span class="line"><span class="cl"><span class="n">predicted_value</span> <span class="o">=</span> <span class="n">regressor</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># é€†å½’ä¸€åŒ–</span>
</span></span><span class="line"><span class="cl"><span class="n">predicted_value</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">predicted_value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># æ¨¡å‹è¯„ä¼°</span>
</span></span><span class="line"><span class="cl"><span class="c1"># trainScore = math.sqrt(mean_squared_error(predicted_value[0], trainPredict[:, 0]))</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;é¢„æµ‹ä¸å®é™…å·®å¼‚MSE&#39;</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">pow</span><span class="p">((</span><span class="n">predicted_value</span> <span class="o">-</span> <span class="n">real_value</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span> <span class="o">/</span> <span class="n">predicted_value</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;é¢„æµ‹ä¸å®é™…å·®å¼‚MAE&#39;</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">predicted_value</span> <span class="o">-</span> <span class="n">real_value</span><span class="p">))</span> <span class="o">/</span> <span class="n">predicted_value</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">val</span> <span class="o">=</span> <span class="n">regressor</span><span class="o">.</span><span class="n">predict</span><span class="p">([[[</span><span class="n">X_test</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:]]]])</span>
</span></span><span class="line"><span class="cl"><span class="n">val</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">blo</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;04&#39;</span><span class="p">,</span> <span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="s1">&#39;06&#39;</span><span class="p">,</span> <span class="s1">&#39;07&#39;</span><span class="p">,</span> <span class="s1">&#39;08&#39;</span><span class="p">,</span> <span class="s1">&#39;09&#39;</span><span class="p">,</span> <span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="s1">&#39;11&#39;</span><span class="p">,</span> <span class="s1">&#39;12&#39;</span><span class="p">,</span> <span class="s1">&#39;01&#39;</span><span class="p">,</span> <span class="s1">&#39;02&#39;</span><span class="p">,</span> <span class="s1">&#39;03&#39;</span><span class="p">,</span> <span class="s1">&#39;04&#39;</span><span class="p">,</span> <span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="s1">&#39;06&#39;</span><span class="p">,</span> <span class="s1">&#39;07&#39;</span><span class="p">,</span> <span class="s1">&#39;08&#39;</span><span class="p">,</span> <span class="s1">&#39;09&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">resl</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl"><span class="n">valu</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">blo</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">    <span class="n">resl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">blo</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">val</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># print(val.shape)</span>
</span></span><span class="line"><span class="cl">    <span class="n">val</span> <span class="o">=</span> <span class="n">regressor</span><span class="o">.</span><span class="n">predict</span><span class="p">([</span><span class="n">val</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:]])</span>
</span></span><span class="line"><span class="cl">    <span class="n">val</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">valu</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="c1"># é¢„æµ‹ä¸å®é™…å·®å¼‚çš„å¯è§†åŒ–</span>
</span></span><span class="line"><span class="cl"><span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">real_value</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;çœŸå®å€¼&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">valu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">valu</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">predicted_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">predicted_value</span><span class="p">,</span> <span class="n">valu</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">predicted_value</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;é¢„æµ‹å€¼&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># plt.title(&#39;TATA Stock Price Prediction&#39;)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;è¿­ä»£æ¬¡æ•°&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;Q3/&#39;</span> <span class="o">+</span> <span class="s1">&#39;q63.jpg&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><h3 id="q3"><a href="#q3" class="anchor-link">#</a><a href="#contents:q3" class="headings">Q3</a></h3>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">#å¯¼åŒ…ç•¥</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">smooth_xy</span><span class="p">(</span><span class="n">lx</span><span class="p">,</span> <span class="n">ly</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;æ•°æ®å¹³æ»‘å¤„ç†
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    :param lx: xè½´æ•°æ®ï¼Œæ•°ç»„
</span></span></span><span class="line"><span class="cl"><span class="s2">    :param ly: yè½´æ•°æ®ï¼Œæ•°ç»„
</span></span></span><span class="line"><span class="cl"><span class="s2">    :return: å¹³æ»‘åçš„xã€yè½´æ•°æ®ï¼Œæ•°ç»„ [slx, sly]
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lx</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ly</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">x_smooth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">300</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">y_smooth</span> <span class="o">=</span> <span class="n">make_interp_spline</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)(</span><span class="n">x_smooth</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">[</span><span class="n">x_smooth</span><span class="p">,</span> <span class="n">y_smooth</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.sans-serif&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SimHei&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.unicode_minus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl"><span class="n">file_dic</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;C:\Users\CYH\Desktop\2022å¹´Eé¢˜\æ•°æ®é›†\ç›‘æµ‹ç‚¹æ•°æ®\é™„ä»¶14ï¼šä¸åŒæ”¾ç‰§å¼ºåº¦åœŸå£¤ç¢³æ°®ç›‘æµ‹æ•°æ®é›†/&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">file_name</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;ä¸åŒæ”¾ç‰§å¼ºåº¦åœŸå£¤ç¢³æ°®ç›‘æµ‹æ•°æ®é›†.xlsx&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;æ”¾ç‰§å¼ºåº¦ï¼ˆintensityï¼‰&#39;</span><span class="p">,</span> <span class="s1">&#39;SOCåœŸå£¤æœ‰æœºç¢³&#39;</span><span class="p">,</span> <span class="s1">&#39;SICåœŸå£¤æ— æœºç¢³&#39;</span><span class="p">,</span> <span class="s1">&#39;å…¨æ°®N&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="n">read_excel</span><span class="p">(</span><span class="n">file_dic</span> <span class="o">+</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="n">cols</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;Sheet1&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">box1</span><span class="p">,</span> <span class="n">box2</span><span class="p">,</span> <span class="n">box3</span><span class="p">,</span> <span class="n">box4</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl"><span class="n">cho</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;NG&#39;</span><span class="p">,</span> <span class="s1">&#39;LGI&#39;</span><span class="p">,</span> <span class="s1">&#39;MGI&#39;</span><span class="p">,</span> <span class="s1">&#39;HGI&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">col</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SOCåœŸå£¤æœ‰æœºç¢³&#39;</span><span class="p">,</span> <span class="s1">&#39;SICåœŸå£¤æ— æœºç¢³&#39;</span><span class="p">,</span> <span class="s1">&#39;å…¨æ°®N&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">gs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">col</span><span class="p">)):</span>  <span class="c1"># è·å–å¯¹åº”æ”¾ç‰§å¼ºåº¦ä¸‹çš„åŒ–å­¦æ€§è´¨</span>
</span></span><span class="line"><span class="cl">    <span class="n">box1</span><span class="p">,</span> <span class="n">box2</span><span class="p">,</span> <span class="n">box3</span><span class="p">,</span> <span class="n">box4</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">cols</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">cho</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">            <span class="n">box1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="n">j</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="n">data</span><span class="p">[</span><span class="n">cols</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">cho</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">            <span class="n">box2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="n">j</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="n">data</span><span class="p">[</span><span class="n">cols</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">cho</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">            <span class="n">box3</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="n">j</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="n">data</span><span class="p">[</span><span class="n">cols</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">cho</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">            <span class="n">box4</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="n">j</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">box1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">box2</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">box3</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">box4</span><span class="p">)])</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="n">wspace</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.45</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">z1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># ç”¨3æ¬¡å¤šé¡¹å¼æ‹Ÿåˆï¼Œè¾“å‡ºç³»æ•°ä»é«˜åˆ°0</span>
</span></span><span class="line"><span class="cl">    <span class="n">p1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">z1</span><span class="p">)</span>  <span class="c1"># ä½¿ç”¨æ¬¡æ•°åˆæˆå¤šé¡¹å¼</span>
</span></span><span class="line"><span class="cl">    <span class="n">y_pre</span> <span class="o">=</span> <span class="n">p1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">zs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">r</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_pre</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">p</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.047</span><span class="p">,</span> <span class="mf">0.029</span><span class="p">,</span><span class="mf">0.24</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ç›¸å…³ç³»æ•°rä¸º = </span><span class="si">%6.3f</span><span class="s1">ï¼Œpå€¼ä¸º = </span><span class="si">%6.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl">    <span class="n">x</span><span class="p">,</span> <span class="n">y_pre</span> <span class="o">=</span> <span class="n">smooth_xy</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y_pre</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">labels</span> <span class="o">=</span> <span class="s2">&#34;y=&#34;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">zs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&#34;x$^2$&#34;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">zs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&#34;x+&#34;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="nb">round</span><span class="p">(</span><span class="n">zs</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">r$^2$=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;, p=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">3</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y_pre</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#cd534c&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># plt.ylabel(labels)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">ylim</span> <span class="o">=</span> <span class="p">[</span><span class="mi">30</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># plt.title(col[i] + &#39;çš„ç®±å‹å›¾&#39;)</span>
</span></span><span class="line"><span class="cl">    <span class="n">labels</span> <span class="o">=</span> <span class="n">cols</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</span></span><span class="line"><span class="cl">    <span class="n">f</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">boxplot</span><span class="p">([</span><span class="n">box1</span><span class="p">,</span> <span class="n">box2</span><span class="p">,</span> <span class="n">box3</span><span class="p">,</span> <span class="n">box4</span><span class="p">],</span> <span class="n">labels</span><span class="o">=</span><span class="n">cho</span><span class="p">,</span> <span class="n">widths</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="n">boxprops</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;#999&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">                    <span class="n">medianprops</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;linestyle&#39;</span><span class="p">:</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;#999&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">                    <span class="n">capprops</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;#999&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">                    <span class="n">whiskerprops</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;#999&#39;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ylim</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;Q3/&#39;</span> <span class="o">+</span> <span class="s1">&#39;q3.jpg&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="c1"># åˆ†ä¸æ¸…äº† è¿™é‡Œåº”è¯¥ä¹Ÿæ˜¯å§</span>
</span></span><span class="line"><span class="cl"><span class="c1"># https://blog.csdn.net/zyxhangiian123456789/article/details/87458140</span>
</span></span><span class="line"><span class="cl"><span class="c1"># https://blog.csdn.net/LaoChengZier/article/details/90511968</span>
</span></span><span class="line"><span class="cl"><span class="c1"># https://deephub.blog.csdn.net/article/details/122425490</span>
</span></span><span class="line"><span class="cl"><span class="c1"># https://blog.csdn.net/weixin_52855810/article/details/112982229</span>
</span></span><span class="line"><span class="cl"><span class="c1"># åˆ›å»ºæ•°æ®é›†</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">create_dataset</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">look_back</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">dataX</span><span class="p">,</span> <span class="n">dataY</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span> <span class="o">-</span> <span class="n">look_back</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">a</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="n">i</span><span class="p">:(</span><span class="n">i</span> <span class="o">+</span> <span class="n">look_back</span><span class="p">),</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># ç”¨look_backä¸ªæ ·æœ¬æ¥é¢„æµ‹ä¸€ä¸ªæ•°æ®</span>
</span></span><span class="line"><span class="cl">        <span class="n">dataX</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">dataY</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dataset</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">look_back</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dataX</span><span class="p">),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dataY</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">iq</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">getValue</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">dataset</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">values</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># å°†æ•´å‹å˜ä¸ºfloat</span>
</span></span><span class="line"><span class="cl">    <span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># æ•°æ®å¤„ç†ï¼Œå½’ä¸€åŒ–è‡³0~1ä¹‹é—´</span>
</span></span><span class="line"><span class="cl">    <span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">(</span><span class="n">feature_range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">dataset</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># åˆ’åˆ†è®­ç»ƒé›†å’Œæµ‹è¯•é›†</span>
</span></span><span class="line"><span class="cl">    <span class="n">train_size</span> <span class="o">=</span> <span class="mi">27</span>
</span></span><span class="line"><span class="cl">    <span class="n">test_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span> <span class="o">-</span> <span class="n">train_size</span>
</span></span><span class="line"><span class="cl">    <span class="n">train</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">train_size</span><span class="p">,</span> <span class="p">:],</span> <span class="n">dataset</span><span class="p">[</span><span class="n">train_size</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">),</span> <span class="p">:]</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># train, test = dataset[:30, :], dataset[:30, :]</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># åˆ›å»ºæµ‹è¯•é›†å’Œè®­ç»ƒé›†</span>
</span></span><span class="line"><span class="cl">    <span class="n">look_back</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="n">trainX</span><span class="p">,</span> <span class="n">trainY</span> <span class="o">=</span> <span class="n">create_dataset</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">look_back</span><span class="p">)</span>  <span class="c1"># å•æ­¥é¢„æµ‹</span>
</span></span><span class="line"><span class="cl">    <span class="n">testX</span><span class="p">,</span> <span class="n">testY</span> <span class="o">=</span> <span class="n">create_dataset</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">look_back</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># è°ƒæ•´è¾“å…¥æ•°æ®çš„æ ¼å¼</span>
</span></span><span class="line"><span class="cl">    <span class="n">trainX</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">trainX</span><span class="p">,</span> <span class="p">(</span><span class="n">trainX</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">look_back</span><span class="p">,</span> <span class="n">trainX</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>  <span class="c1"># ï¼ˆæ ·æœ¬ä¸ªæ•°ï¼Œ1ï¼Œè¾“å…¥çš„ç»´åº¦ï¼‰</span>
</span></span><span class="line"><span class="cl">    <span class="n">testX</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">testX</span><span class="p">,</span> <span class="p">(</span><span class="n">testX</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">look_back</span><span class="p">,</span> <span class="n">testX</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># åˆ›å»ºLSTMç¥ç»ç½‘ç»œæ¨¡å‹</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">LSTM</span><span class="p">(</span><span class="mi">120</span><span class="p">,</span> <span class="n">unit_forget_bias</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="n">trainX</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">trainX</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">])))</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">LSTM</span><span class="p">(</span><span class="mi">100</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># model.add(Dropout(0.2))</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># model.add(LSTM(120, input_shape=(trainX.shape[1], trainX.shape[2])))  # è¾“å…¥ç»´åº¦ä¸º1ï¼Œæ—¶é—´çª—çš„é•¿åº¦ä¸º1ï¼Œéšå«å±‚ç¥ç»å…ƒèŠ‚ç‚¹ä¸ªæ•°ä¸º120</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># model.add(Dense(1))</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s1">&#39;mean_squared_error&#39;</span><span class="p">,</span> <span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;sgd&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># ç»˜åˆ¶ç½‘ç»œç»“æ„</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># plot_model(model, to_file=&#39;model.png&#39;, show_shapes=True)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">history</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">trainX</span><span class="p">,</span> <span class="n">trainY</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">testX</span><span class="p">,</span> <span class="n">testY</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># é¢„æµ‹</span>
</span></span><span class="line"><span class="cl">    <span class="n">trainPredict</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">trainX</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">testPredict</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">testX</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># print(trainPredict.shape, testPredict.shape)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># åå½’ä¸€åŒ–</span>
</span></span><span class="line"><span class="cl">    <span class="n">trainPredict</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">trainPredict</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">trainY</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">([</span><span class="n">trainY</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">testPredict</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">testPredict</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">testY</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">([</span><span class="n">testY</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># è®¡ç®—å¾—åˆ†</span>
</span></span><span class="line"><span class="cl">    <span class="n">trainScore</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">trainY</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">trainPredict</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Train Score: </span><span class="si">%.2f</span><span class="s1"> RMSE&#39;</span> <span class="o">%</span> <span class="n">trainScore</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">testScore</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">testY</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">testPredict</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Test Score: </span><span class="si">%.2f</span><span class="s1"> RMSE&#39;</span> <span class="o">%</span> <span class="n">testScore</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;loss&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;val_loss&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;model train vs validation loss&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;loss&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;epoch&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;train&#39;</span><span class="p">,</span> <span class="s1">&#39;validation&#39;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">val</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">([[[</span><span class="n">testX</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]]])</span>
</span></span><span class="line"><span class="cl">    <span class="n">val</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">blo</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">resl</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">blo</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">        <span class="n">resl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">blo</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="n">val</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">val</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">([[[</span><span class="n">val</span><span class="p">]]])</span>
</span></span><span class="line"><span class="cl">        <span class="n">val</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># ç»˜</span>
</span></span><span class="line"><span class="cl">    <span class="n">trainPredictPlot</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">trainPredictPlot</span><span class="p">[:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nan</span>
</span></span><span class="line"><span class="cl">    <span class="n">trainPredictPlot</span><span class="p">[</span><span class="n">look_back</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">trainPredict</span><span class="p">)</span> <span class="o">+</span> <span class="n">look_back</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">trainPredict</span>
</span></span><span class="line"><span class="cl">    <span class="n">testPredictPlot</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">testPredictPlot</span><span class="p">[:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nan</span>
</span></span><span class="line"><span class="cl">    <span class="n">testPredictPlot</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">trainPredict</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">look_back</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">testPredict</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">dataset</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;çœŸå®å€¼&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">trainPredictPlot</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;è®­ç»ƒå€¼&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">testPredictPlot</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;é¢„æµ‹å€¼&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># plt.title(name + &#39;æ‹Ÿåˆæ›²çº¿&#39;)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;å€¼&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;picture/lstm/&#39;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">iq</span><span class="p">),</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">pad_inches</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># plt.show()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">resl</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">resl</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">load_data</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">cho</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;NG&#39;</span><span class="p">,</span> <span class="s1">&#39;LGI&#39;</span><span class="p">,</span> <span class="s1">&#39;MGI&#39;</span><span class="p">,</span> <span class="s1">&#39;HGI&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SOCåœŸå£¤æœ‰æœºç¢³&#39;</span><span class="p">,</span> <span class="s1">&#39;SICåœŸå£¤æ— æœºç¢³&#39;</span><span class="p">,</span> <span class="s1">&#39;å…¨æ°®N&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cho</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;æ”¾ç‰§å¼ºåº¦ï¼ˆintensityï¼‰&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">:</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">col</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">results</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># åŠ è½½æ•°æ®</span>
</span></span><span class="line"><span class="cl">    <span class="n">file_dic</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;C:\Users\Desktop\2022å¹´Eé¢˜\æ•°æ®é›†\ç›‘æµ‹ç‚¹æ•°æ®\é™„ä»¶14ï¼šä¸åŒæ”¾ç‰§å¼ºåº¦åœŸå£¤ç¢³æ°®ç›‘æµ‹æ•°æ®é›†/&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">file_name</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;ä¸åŒæ”¾ç‰§å¼ºåº¦åœŸå£¤ç¢³æ°®ç›‘æµ‹æ•°æ®é›†.xlsx&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;æ”¾ç‰§å¼ºåº¦ï¼ˆintensityï¼‰&#39;</span><span class="p">,</span> <span class="s1">&#39;SOCåœŸå£¤æœ‰æœºç¢³&#39;</span><span class="p">,</span> <span class="s1">&#39;SICåœŸå£¤æ— æœºç¢³&#39;</span><span class="p">,</span> <span class="s1">&#39;å…¨æ°®N&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">dataframe</span> <span class="o">=</span> <span class="n">read_excel</span><span class="p">(</span><span class="n">file_dic</span> <span class="o">+</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="n">cols</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">dataframe</span> <span class="o">=</span> <span class="n">load_data</span><span class="p">(</span><span class="n">dataframe</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">        <span class="n">res</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="n">cols</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">[</span><span class="mi">1</span><span class="p">:])):</span>
</span></span><span class="line"><span class="cl">            <span class="n">iq</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">            <span class="n">temp</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="n">cols</span><span class="p">[</span><span class="mi">1</span> <span class="o">+</span> <span class="n">j</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl">            <span class="n">name</span> <span class="o">=</span> <span class="n">cols</span><span class="p">[</span><span class="mi">1</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">val</span> <span class="o">=</span> <span class="n">getValue</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">val</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="n">k</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><h3 id="q5-æ²¡åšå‡ºæ¥-å¥½åƒç›´æ¥è¯­æ–‡å»ºæ¨¡äº†"><a href="#q5-æ²¡åšå‡ºæ¥-å¥½åƒç›´æ¥è¯­æ–‡å»ºæ¨¡äº†" class="anchor-link">#</a><a href="#contents:q5-æ²¡åšå‡ºæ¥-å¥½åƒç›´æ¥è¯­æ–‡å»ºæ¨¡äº†" class="headings">Q5 æ²¡åšå‡ºæ¥ å¥½åƒç›´æ¥è¯­æ–‡å»ºæ¨¡äº†</a></h3>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">load_data</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">file14_dic</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;C:\Users\Desktop\2022å¹´Eé¢˜\æ•°æ®é›†\ç›‘æµ‹ç‚¹æ•°æ®\é™„ä»¶14ï¼šä¸åŒæ”¾ç‰§å¼ºåº¦åœŸå£¤ç¢³æ°®ç›‘æµ‹æ•°æ®é›†/&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">file14_name</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;ä¸åŒæ”¾ç‰§å¼ºåº¦åœŸå£¤ç¢³æ°®ç›‘æµ‹æ•°æ®é›†.csv&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">file15_dic</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;C:\Users\Desktop\2022å¹´Eé¢˜\æ•°æ®é›†\ç›‘æµ‹ç‚¹æ•°æ®\é™„ä»¶15ï¼šè‰åŸè½®ç‰§æ”¾ç‰§æ ·åœ°ç¾¤è½ç»“æ„ç›‘æµ‹æ•°æ®é›†ï¼ˆ2016å¹´6æœˆ-2020å¹´9æœˆï¼‰ã€‚/&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">file15_name</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;å†…è’™å¤è‡ªæ²»åŒºé”¡æ—éƒ­å‹’ç›Ÿå…¸å‹è‰åŸè½®ç‰§æ”¾ç‰§æ ·åœ°ç¾¤è½ç»“æ„ç›‘æµ‹æ•°æ®é›†ï¼ˆ201.xlsx&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">data15</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">file15_dic</span> <span class="o">+</span> <span class="n">file15_name</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;Sheet1&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">data14</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file14_dic</span> <span class="o">+</span> <span class="n">file14_name</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;unicode_escape&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">data15</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">data14</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">X</span> <span class="o">=</span> <span class="n">data14</span><span class="p">[[</span><span class="s1">&#39;SOC&#39;</span><span class="p">,</span> <span class="s1">&#39;SIC&#39;</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="s1">&#39;jyl&#39;</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl">    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">Y</span> <span class="o">=</span> <span class="n">data14</span><span class="p">[</span><span class="s1">&#39;intensity&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">,</span> <span class="n">Y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">Y_train</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">score</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; å¾—åˆ†:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">score</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">17</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#E0A97C&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&#34;TRUE&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#889BB7&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&#34;PREDICT&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">mse</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">Y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">Y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">Y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>  <span class="c1"># RMSEå°±æ˜¯å¯¹MSEå¼€æ–¹å³å¯</span>
</span></span><span class="line"><span class="cl">    <span class="n">r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">Y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;mse: &#39;</span><span class="p">,</span> <span class="n">mse</span><span class="p">,</span> <span class="s1">&#39;mae: &#39;</span><span class="p">,</span> <span class="n">mae</span><span class="p">,</span> <span class="s1">&#39;rmse: &#39;</span><span class="p">,</span> <span class="n">rmse</span><span class="p">,</span> <span class="s1">&#39;r2: &#39;</span><span class="p">,</span> <span class="n">r2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">([])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">load_data</span><span class="p">()</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><h3 id="q6-ç”¨æ¥lstmå’Œrnn"><a href="#q6-ç”¨æ¥lstmå’Œrnn" class="anchor-link">#</a><a href="#contents:q6-ç”¨æ¥lstmå’Œrnn" class="headings">Q6 ç”¨æ¥LSTMå’ŒRNN</a></h3>
<p>ä½†æ˜¯rnnä»£ç ä¸¢äº†</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">read_excel</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">math</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">keras.models</span> <span class="kn">import</span> <span class="n">Sequential</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">keras.layers</span> <span class="kn">import</span> <span class="n">Dense</span><span class="p">,</span> <span class="n">Dropout</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">keras.layers</span> <span class="kn">import</span> <span class="n">LSTM</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">keras.utils.vis_utils</span> <span class="kn">import</span> <span class="n">plot_model</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è§£å†³ä¸­æ–‡æ˜¾ç¤ºé—®é¢˜</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.sans-serif&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SimHei&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.unicode_minus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># åˆ›å»ºæ•°æ®é›†</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">create_dataset</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">look_back</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">dataX</span><span class="p">,</span> <span class="n">dataY</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span> <span class="o">-</span> <span class="n">look_back</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">a</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="n">i</span><span class="p">:(</span><span class="n">i</span> <span class="o">+</span> <span class="n">look_back</span><span class="p">),</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># ç”¨look_backä¸ªæ ·æœ¬æ¥é¢„æµ‹ä¸€ä¸ªæ•°æ®</span>
</span></span><span class="line"><span class="cl">        <span class="n">dataX</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">dataY</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dataset</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">look_back</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dataX</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dataY</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">file_dic</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;C:\Users\Desktop\2022å¹´Eé¢˜\æ•°æ®é›†\åŸºæœ¬æ•°æ®/&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">file_name</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;é™„ä»¶6ã€æ¤è¢«æŒ‡æ•°-NDVI2012-2022å¹´.xls&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">file_dic</span> <span class="o">+</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;sheet1&#39;</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;æ¤è¢«æŒ‡æ•°(NDVI)&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">data1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">165.92</span><span class="p">,</span> <span class="mf">165.92</span><span class="p">,</span> <span class="mf">165.92</span><span class="p">,</span> <span class="mf">165.92</span><span class="p">,</span> <span class="mf">165.91</span><span class="p">,</span> <span class="mf">165.71</span><span class="p">,</span> <span class="mf">165.46</span><span class="p">,</span> <span class="mf">165.15</span><span class="p">,</span> <span class="mf">164.85</span><span class="p">,</span> <span class="mf">164.59</span><span class="p">,</span> <span class="mf">164.49</span><span class="p">,</span> <span class="mf">164.48</span><span class="p">,</span> <span class="mf">12.86</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                  <span class="mf">12.26</span><span class="p">,</span> <span class="mf">13.48</span><span class="p">,</span> <span class="mf">12.53</span><span class="p">,</span> <span class="mf">10.96</span><span class="p">,</span> <span class="mf">16.88</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="n">dataset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># å°†æ•´å‹å˜ä¸ºfloat</span>
</span></span><span class="line"><span class="cl"><span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># æ•°æ®å¤„ç†ï¼Œå½’ä¸€åŒ–è‡³0~1ä¹‹é—´</span>
</span></span><span class="line"><span class="cl"><span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">(</span><span class="n">feature_range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">dataset</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># åˆ’åˆ†è®­ç»ƒé›†å’Œæµ‹è¯•é›†</span>
</span></span><span class="line"><span class="cl"><span class="n">train_size</span> <span class="o">=</span> <span class="mi">100</span>
</span></span><span class="line"><span class="cl"><span class="n">test_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span> <span class="o">-</span> <span class="n">train_size</span>
</span></span><span class="line"><span class="cl"><span class="n">train</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">train_size</span><span class="p">,</span> <span class="p">:],</span> <span class="n">dataset</span><span class="p">[</span><span class="n">train_size</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">),</span> <span class="p">:]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># train, test = dataset[:30, :], dataset[:30, :]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># åˆ›å»ºæµ‹è¯•é›†å’Œè®­ç»ƒé›†</span>
</span></span><span class="line"><span class="cl"><span class="n">look_back</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="n">trainX</span><span class="p">,</span> <span class="n">trainY</span> <span class="o">=</span> <span class="n">create_dataset</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">look_back</span><span class="p">)</span>  <span class="c1"># å•æ­¥é¢„æµ‹</span>
</span></span><span class="line"><span class="cl"><span class="n">testX</span><span class="p">,</span> <span class="n">testY</span> <span class="o">=</span> <span class="n">create_dataset</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">look_back</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è°ƒæ•´è¾“å…¥æ•°æ®çš„æ ¼å¼</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">trainX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">trainX</span><span class="p">,</span> <span class="p">(</span><span class="n">trainX</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">look_back</span><span class="p">,</span> <span class="n">trainX</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>  <span class="c1"># ï¼ˆæ ·æœ¬ä¸ªæ•°ï¼Œ1ï¼Œè¾“å…¥çš„ç»´åº¦ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="n">testX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">testX</span><span class="p">,</span> <span class="p">(</span><span class="n">testX</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">look_back</span><span class="p">,</span> <span class="n">testX</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">testX</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># åˆ›å»ºLSTMç¥ç»ç½‘ç»œæ¨¡å‹</span>
</span></span><span class="line"><span class="cl"><span class="n">model</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="c1"># model.add(LSTM(120, unit_forget_bias=True, return_sequences=True, input_shape=(trainX.shape[1], trainX.shape[2])))</span>
</span></span><span class="line"><span class="cl"><span class="c1"># model.add(Dropout(0.2))</span>
</span></span><span class="line"><span class="cl"><span class="c1"># model.add(Dense(1))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">LSTM</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="n">trainX</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">trainX</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">])))</span>  <span class="c1"># è¾“å…¥ç»´åº¦ä¸º1ï¼Œæ—¶é—´çª—çš„é•¿åº¦ä¸º1ï¼Œéšå«å±‚ç¥ç»å…ƒèŠ‚ç‚¹ä¸ªæ•°ä¸º120</span>
</span></span><span class="line"><span class="cl"><span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s1">&#39;mean_squared_error&#39;</span><span class="p">,</span> <span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">model</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ç»˜åˆ¶ç½‘ç»œç»“æ„</span>
</span></span><span class="line"><span class="cl"><span class="c1"># plot_model(model, to_file=&#39;model.png&#39;, show_shapes=True)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">history</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">trainX</span><span class="p">,</span> <span class="n">trainY</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">testX</span><span class="p">,</span> <span class="n">testY</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># é¢„æµ‹</span>
</span></span><span class="line"><span class="cl"><span class="n">trainPredict</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">trainX</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">testPredict</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">testX</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># print(trainPredict.shape, testPredict.shape)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># åå½’ä¸€åŒ–</span>
</span></span><span class="line"><span class="cl"><span class="n">trainPredict</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">trainPredict</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.6</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">trainY</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">([</span><span class="n">trainY</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">testPredict</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">testPredict</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.6</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">testY</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">([</span><span class="n">testY</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="c1"># è®¡ç®—å¾—åˆ†</span>
</span></span><span class="line"><span class="cl"><span class="n">trainScore</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">trainY</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">trainPredict</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Train Score: </span><span class="si">%.2f</span><span class="s1"> RMSE&#39;</span> <span class="o">%</span> <span class="n">trainScore</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">testScore</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">testY</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">testPredict</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Test Score: </span><span class="si">%.2f</span><span class="s1"> RMSE&#39;</span> <span class="o">%</span> <span class="n">testScore</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;loss&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;è®­ç»ƒæŸå¤±&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;val_loss&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;éªŒè¯æŸå¤±&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;æŸå¤±&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;è½®æ¬¡&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;è®­ç»ƒé›†æŸå¤±&#39;</span><span class="p">,</span> <span class="s1">&#39;éªŒè¯é›†æŸå¤±&#39;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># print(testX[-6:].shape)</span>
</span></span><span class="line"><span class="cl"><span class="n">val</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">([[[</span><span class="n">testX</span><span class="p">[</span><span class="o">-</span><span class="mi">21</span><span class="p">:]]]])</span>
</span></span><span class="line"><span class="cl"><span class="n">val</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">blo</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;04&#39;</span><span class="p">,</span> <span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="s1">&#39;06&#39;</span><span class="p">,</span> <span class="s1">&#39;07&#39;</span><span class="p">,</span> <span class="s1">&#39;08&#39;</span><span class="p">,</span> <span class="s1">&#39;09&#39;</span><span class="p">,</span> <span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="s1">&#39;11&#39;</span><span class="p">,</span> <span class="s1">&#39;12&#39;</span><span class="p">,</span> <span class="s1">&#39;01&#39;</span><span class="p">,</span> <span class="s1">&#39;02&#39;</span><span class="p">,</span> <span class="s1">&#39;03&#39;</span><span class="p">,</span> <span class="s1">&#39;04&#39;</span><span class="p">,</span> <span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="s1">&#39;06&#39;</span><span class="p">,</span> <span class="s1">&#39;07&#39;</span><span class="p">,</span> <span class="s1">&#39;08&#39;</span><span class="p">,</span> <span class="s1">&#39;09&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">resl</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl"><span class="n">valu</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">blo</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">    <span class="n">resl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">blo</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">val</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># print(val.shape)</span>
</span></span><span class="line"><span class="cl">    <span class="n">val</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">([</span><span class="n">val</span><span class="p">[</span><span class="o">-</span><span class="mi">21</span><span class="p">:]])</span>
</span></span><span class="line"><span class="cl">    <span class="n">val</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">valu</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">0.2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ç»˜</span>
</span></span><span class="line"><span class="cl"><span class="n">trainPredictPlot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">trainPredictPlot</span><span class="p">[:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span></span><span class="line"><span class="cl"><span class="n">trainPredictPlot</span><span class="p">[</span><span class="n">look_back</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">trainPredict</span><span class="p">)</span> <span class="o">+</span> <span class="n">look_back</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">trainPredict</span>
</span></span><span class="line"><span class="cl"><span class="n">testPredictPlot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">testPredictPlot</span><span class="p">[:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span></span><span class="line"><span class="cl"><span class="n">testPredictPlot</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">trainPredict</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">look_back</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">testPredict</span>
</span></span><span class="line"><span class="cl"><span class="c1"># fig, ax = plt.figure()</span>
</span></span><span class="line"><span class="cl"><span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">dataset</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;çœŸå®å€¼&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">trainPredictPlot</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;è®­ç»ƒå€¼&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">valu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">valu</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">testPredictPlot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">testPredictPlot</span><span class="p">,</span> <span class="n">valu</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># print(testPredictPlot.shape)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">testPredictPlot</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;é¢„æµ‹å€¼&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># plt.title(name + &#39;æ‹Ÿåˆæ›²çº¿&#39;)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;å€¼&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;picture/lstm/&#39;</span> <span class="o">+</span> <span class="s1">&#39;Q61&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">pad_inches</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="c1"># plt.savefig(&#39;Q3/&#39; + &#39;q62.jpg&#39;, dpi=300)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">resl</span><span class="p">)</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="anchor-link">#</a><a href="#contents:æ€»ç»“" class="headings">æ€»ç»“</a></h2>
<p>è¿™é‡Œä»£ç æœ‰äº›æ®‹ç¼ºï¼Œå»ºè®®è°¨æ…å‚è€ƒï¼Œä¸€äº›åœ°æ–¹çš„ä»£ç å·²é™„æ¥æºã€‚</p>

            </div>

            


        </article>

        

        


        


        


        


        


        
    <footer class="minimal-footer">
        
            <div class="post-tag"><a href="/tags/python/" rel="tag" class="post-tag-link">#python</a></div>
        
        
            <div class="post-category">
                <a href="/posts/" class="post-category-link active">posts</a> | 
            </div>
        
        
    </footer>



        


        


        


    </div>
</main>


            
    <div id="back-to-top" class="back-to-top">
        <a href="#"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="icon arrow-up"><path d="M34.9 289.5l-22.2-22.2c-9.4-9.4-9.4-24.6 0-33.9L207 39c9.4-9.4 24.6-9.4 33.9 0l194.3 194.3c9.4 9.4 9.4 24.6 0 33.9L413 289.4c-9.5 9.5-25 9.3-34.3-.4L264 168.6V456c0 13.3-10.7 24-24 24h-32c-13.3 0-24-10.7-24-24V168.6L69.2 289.1c-9.3 9.8-24.8 10-34.3.4z"/></svg></a>
    </div>


            

        </div>
        

        
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.css">
<script>
    if (typeof renderMathInElement === 'undefined') {
        const getScript = (options) => {
            const script = document.createElement('script');
            script.defer = true;
            script.crossOrigin = 'anonymous';
            Object.keys(options).forEach((key) => {
                script[key] = options[key];
            });
            document.body.appendChild(script);
        };
        getScript({
            src: 'https:\/\/cdn.jsdelivr.net\/npm\/katex@0.13.0\/dist\/katex.min.js',
            onload: () => {
                getScript({
                    src: 'https:\/\/cdn.jsdelivr.net\/npm\/katex@0.13.0\/dist\/contrib\/mhchem.min.js',
                    onload: () => {
                        getScript({
                            src: 'https:\/\/cdn.jsdelivr.net\/npm\/katex@0.13.0\/dist\/contrib\/auto-render.min.js',
                            onload: () => {
                                renderKaTex();
                            }
                        });
                    }
                });
            }
        });
    } else {
        renderKaTex();
    }
    function renderKaTex() {
        renderMathInElement(
            document.body,
            {
                delimiters: [
                    {left: "$$", right: "$$", display: true},
                    {left: "\\[", right: "\\]", display: true},
                    {left: "$", right: "$", display: false},
                    {left: "\\(", right: "\\)", display: false}
                ]
            }
        );
    }
</script>










    <script src="https://cdn.jsdelivr.net/npm/medium-zoom@latest/dist/medium-zoom.min.js"></script>

<script>
    let imgNodes = document.querySelectorAll('div.post-body img');
    imgNodes = Array.from(imgNodes).filter(node => node.parentNode.tagName !== "A");

    mediumZoom(imgNodes, {
        background: 'hsla(var(--color-bg-h), var(--color-bg-s), var(--color-bg-l), 0.95)'
    })
</script>









    </body>
</html>
